<!DOCTYPE html>
<html lang="zh-CN,en,default">
  <head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="preload" href="/css/first.css" as="style">
  

  <!-- 页面元数据 -->
  
  <title>计算机网络 - Bezhuang&#39;s Blog</title>
  

  
    <meta name="description" content="
计算机网络是计算机专业必修的重要课程之一，与现实世界结合得相当紧密，也是考研计算机学科专业基础综合考试中的一门课程。计算机网络就是一些互联的、自治的计算机系统的集合。自治计算机就是能够进行自我管理、配置和维护的计算机。计算机网络学习的核心内容就是网络协议的学习。网络协议是为计算机网络中进行数据交换而建立的规则、...">
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Bezhuang's Blog" type="application/atom+xml">
  

  <!-- import meta -->
  

  <!-- link -->
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>

  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        '<h1><b>抱歉，您的浏览器无法访问本站</b></h1>'+
        '<h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>'+
        '继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/>'+
        '<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a>'+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
	</style>
    <div class="kill-noscript">
        <h1><b>抱歉，您的浏览器无法访问本站</b></h1>
        <h3>本页面需要浏览器支持（启用）JavaScript</h3><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a>
    </div>
</noscript>

</head>

  <body>
    

<header id="l_header" class="l_header always shadow blur show"  >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
            Bezhuang's Blog
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于我
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/projects
                  
                  
                  
                    id="projects"
                  >
                  <i class='far fa-hdd fa-fw'></i>开源库
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>暗黑模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于我
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/projects
                  
                  
                  
                    id="projects"
                  >
                  <i class='far fa-hdd fa-fw'></i>开源库
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>暗黑模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
    
        <div id="full" class='cover-wrapper post search' style="display: none;">
          
            <div class='cover-bg' style='background-image:url(/img/c言语入门.png)'></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">庄之皓 · Bezhuang</p>
    
    
      <p class="subtitle">欢迎访问我的博客！Welcome to my blog!</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="search here..." />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

      <div id="safearea">
        <div class="body-wrapper" id="pjax-container">
          

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        计算机网络
      </h1>
      <div class='new-meta-box'>
        
          
            
  <div class='new-meta-item category'>
    <a class='notlink'>
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/">计算机科学与技术</a>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>本文发布于：2021年12月10日</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item wordcount">
    <a class='notlink'>
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：20.2k字</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class='notlink'>
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：69分钟</p>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  
  <blockquote>
<p>计算机网络是计算机专业必修的重要课程之一，与现实世界结合得相当紧密，也是考研计算机学科专业基础综合考试中的一门课程。计算机网络就是一些互联的、自治的计算机系统的集合。自治计算机就是能够进行自我管理、配置和维护的计算机。计算机网络学习的核心内容就是网络协议的学习。网络协议是为计算机网络中进行数据交换而建立的规则、标准或者说是约定的集合。</p>
</blockquote>
<span id="more"></span>
<h3 id="一、计算机网络体系结构"><a href="#一、计算机网络体系结构" class="headerlink" title="一、计算机网络体系结构"></a>一、计算机网络体系结构</h3><h4 id="计算机网络的概念"><a href="#计算机网络的概念" class="headerlink" title="计算机网络的概念"></a>计算机网络的概念</h4><p>计算机网络：是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。</p>
<p>计算机网络是互连的、自治的计算机集合。互连：通过通信链路互联互通，自治：无主从关系。</p>
<p>计算机网络的功能</p>
<ol>
<li>数据通信。</li>
<li>资源共享：同一个计算机网络上的其他计算机可使用某台计算机的计算机资源的行为，可共享硬件、软件、数据。</li>
<li>分布式处理：多台计算机各自承担同一工作任务的不同部分，如：Hadoop 平台。</li>
<li>提高可靠性：替代机。</li>
<li>负载均衡：使得各计算机之间更亲密。</li>
</ol>
<p>计算机网络的发展：</p>
<ol>
<li>ARPAnet 阿帕网美国国防部高级研究计划局的设计一个分散的指挥系统 -&gt; internet（interconnected network）互联网希望实现不同网络互联 -&gt; 1983 年阿帕网接受 TCP/IP，选定 Internet 因特网为主要的计算机通信系统。</li>
<li>网络把许多计算机连接在一起, 而互联网则把许多网络连接在一起,因特网是世界上最大的互联网。</li>
<li>ISP : 因特网服务提供者/因特网服务提供商，是一个向广大用户综合提供互联网接入业务、信息业务、和增值业务的公司，如中国电信、中国联动、中国移动等。分为主干 ISP、地区 ISP 和本地 ISP。</li>
</ol>
<h4 id="计算机网络的组成"><a href="#计算机网络的组成" class="headerlink" title="计算机网络的组成"></a>计算机网络的组成</h4><p>组成部分：硬件、软件、协议（一系列规则和约定的集合）</p>
<p>工作方式：边缘部分（用户直接使用、C/S 方式或 P2P 方式）、核心部分为边缘部分服务</p>
<p>功能组成：通信子网（各种传输介质、通信设备、相应的网络协议组成，实现数据通信）、资源子网（实现资源共享/数据处理功能的设备和软件的集合）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">ISO/OSI 模型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">应用层</td>
</tr>
<tr>
<td style="text-align:center">表示层</td>
</tr>
<tr>
<td style="text-align:center">会话层</td>
</tr>
<tr>
<td style="text-align:center">传输层</td>
</tr>
<tr>
<td style="text-align:center">网络层（路由器）</td>
</tr>
<tr>
<td style="text-align:center">数据链路层（交换机，网桥）</td>
</tr>
<tr>
<td style="text-align:center">物理层（集线器，中继器）</td>
</tr>
</tbody>
</table>
</div>
<p>传输层是用户的资源子网与通信子网的界面和桥梁，下面三层属于通信子网，面向数据通信，上面三层属于资源子网，面向数据处理，传输层是OSI协议中最重要的一层。</p>
<p>计算机网络的分类：</p>
<ol>
<li>按分布范围分：广域网（WAN、交换技术）、城域网（MAN）、局域网（LAN、广播技术）、个人区域网（PAN）。</li>
<li>按使用者分：公用网（中国电信）、专用网（军用网）。</li>
<li>按交换技术分：电路交换、报文交换、分组交换。</li>
<li>按拓扑结构分：总线型、星型、环型、网状型（常用于广域网）。</li>
<li>按传输技术分：广播式网络（共享公共通信信道）、点对点网络（使用分组存储转发和路由选择机制）</li>
</ol>
<p>标准化工作及相关组织（了解）：标准化对计算机网络至关重要，要确定实现不同厂商的硬、软件之间相互连通，必须遵从统一的标准。</p>
<ul>
<li>法定标准：由权威机构制定的正式的、合法标准的分类，如 OSI。</li>
<li>事实标准：某些公司的产品在竞争中占据了主流，时间长了，这些产品中的协议和技术就成了标准，如 TCP/IP。</li>
<li>RFC（Request For Comments）：因特网标准的形式。</li>
<li>标准化工作的相关组织：国际标准化组织 ISO（OSI 模型、HDLC 协议）、国际电信联盟 ITU（制定通信规则）、电气和电子工程师协会 IEEE（学术机构、IEEE802 系列标准、5G）、Internet 工程任务组 ETF（负责因特网相关标准的制定、RFC XXXX）。</li>
</ul>
<h4 id="计算机网络性能指标"><a href="#计算机网络性能指标" class="headerlink" title="计算机网络性能指标"></a>计算机网络性能指标</h4><p>速率：数据率或称数据传输率或比特率。即连接在计算机网络上的主机在数字信道上传送数据位数的速率。单位是 b/s, kb/s, Mb/s, Gb/s, Tb/s。</p>
<p>存储容量：1 Byte（字节）= 8 bit。1KB = $2^{10}$ Byte，1 MB = $2^{10}$ KB。 </p>
<p>带宽：网络设备所支持的最高速度。原本指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹（Hz）。计算机网络中，带宽用来表示网络的通信线路传送数据的能力，通常是指单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。单位是“比特每秒”，b/s，kb/s，Mb/s，Gb/s。</p>
<p>吞吐量：在单位时间内通过某个网络（或信道、接口）的数据量。单位 b/s，kb/s，Mb/s 等。吞吐量受网络的带宽或网络的额定速率的限制。</p>
<p>时延：数据（报文/分组/比特流）从网络（或链路）的一端传送到另一端所需的时间。也叫延迟或迟延。单位是 s。时延 = 发送时延（从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间）+ 传播时延（取决于电磁波传播速度和链路长度）+ 排队时延（等待输出/入链路可用）+ 处理时延（检错/找出口）。</p>
<p>$发送时延 = \dfrac{数据长度}{信道带宽（发送速率）}$；$传播时延 = \dfrac{信道长度}{电磁波在信道上的传播速率）}$。</p>
<p>$时延带宽积（bit） = 传播时延（s）\times 带宽（b/s）$。时延带宽积又称为以比特为单位的链路长度，即“某段链路现在有多少比特”。</p>
<p>往返时延（RTT）：从发送方发送数据开始，到发送方收到接收方的确认（接收方收到数据后立即发送确认），总共经历的时延。例如：Ping baidu.com。RTT 包括往返传播时延（$传播时延\times 2$）+ 末端处理时间。RTT 越大，在收到确认之前，可以发送的数据越多。</p>
<p>利用率：信道利用率（$\dfrac{有数据通过时间}{总时间}$）和网络利用率（信道利用率加权平均值）。</p>
<h4 id="计算机网络体系结构"><a href="#计算机网络体系结构" class="headerlink" title="计算机网络体系结构"></a>计算机网络体系结构</h4><p>网络体系结构是从功能上描述计算机网络结构。计算机网络体系结构简称网络体系结构是分层结构。每层遵循某个/些网络协议以完成本层功能。计算机网络体系结构是计算机网络的各层及其协议的集合。第 n 层在向 n+1 层提供服务时，此服务不仅包含第 n 层本身的功能，还包含由下层服务提供的功能。仅仅在相邻层间有接口，且所提供服务的具体实现细节对上一层完全屏蔽。体系结构是抽象的，而实现是指能运行的一些软件和硬件。</p>
<p>实体：第 n 层中的活动元素称为 n 层实体。同一层的实体叫对等实体。</p>
<p>协议：为进行网络中的对等实体数据交换而建立的规则、标准或约定称为网络协议。【水平】语法规定传输数据的格式，语义规定所要完成的功能，同步规定各种操作的顺序</p>
<p>接口（访问服务点SAP）：上层使用下层服务的入口。</p>
<p>服务：下层为相邻上层提供的功能调用。【垂直】</p>
<p>SDU 服务数据单元：为完成用户所要求的功能而应传送的数据。</p>
<p>PCI 协议控制信息：控制协议操作的信息。</p>
<p>PDU 协议数据单元：对等层次之间传送的数据单位。PDU = PCI + SDU</p>
<p>服务分层的基本原则：</p>
<ol>
<li>各层之间相互独立，每层只实现一种相对独立的功能。</li>
<li>每层之间界面自然清晰，易于理解，相互交流尽可能少。</li>
<li>结构上可分割开。每层都采用最合适的技术来实现。</li>
<li>保持下层对上层的独立性，上层单向使用下层提供的服务。</li>
<li>整个分层结构应该能促进标准化工作。</li>
</ol>
<p>计算机网络分层结构：</p>
<ul>
<li>法定标准：7 层 OSI 参考模型。</li>
<li>事实标准：4 层 TCP/IP 参考模型。</li>
</ul>
<h4 id="ISO-OSI-参考模型"><a href="#ISO-OSI-参考模型" class="headerlink" title="ISO/OSI 参考模型"></a>ISO/OSI 参考模型</h4><p>国际标准化组织（ISO）于 1984 年提出开放系统互连（OSI）参考模型。目的：支持异构网络系统的互联互通。</p>
<p>端到端：应用层、表示层、会话层、传输层；点到点：网络层、数据链路层、物理层。记忆方法：“物联网淑惠试用”。</p>
<p>应用层：用户与网络的界面，所有能和用户交互产生网络流量的程序。典型应用层服务：文件传输（FTP）、电子邮件 (SMTP）、万维网（HTTP）。</p>
<p>表示层：用于处理在两个通信系统中交换信息的表示方式（语法和语义）。功能：数据格式变换、数据加密解密、数据压缩和恢复。主要协议 ：JPEG、ASCII。</p>
<p>会话层：向表示层实体/用户进程提供建立连接并在连接上有序地传输数据。这是会话，也是建立同步（SYN）。功能：建立、管理、终止会话，使用校验点可使会话在通信失效时从校验点/同步点继续恢复通信，实现数据同步，适用于传输大文件。主要协议 ：ADSP、ASP。</p>
<p>传输层：负责主机中两个进程的通信，即端到端的通信。传输单位是报文段或用户数据报。功能：可靠传输、不可靠传输，差错控制，流量控制，复用分用。主要协议：TCP、UDP。</p>
<p>复用：多个应用层进程可同时使用下面运输层的服务。分用：运输层把收到的信息分别交付给上面应用层中相应的进程。</p>
<p>网络层：主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是数据报。应用层功能：路由选择（最佳路径）、流量控制、差错控制、拥塞控制（若所有结点都来不及接受分组，而要丢弃大量分组数据链路层的话，网络就处于拥塞状态，因此要采取一定措施缓解这种拥塞。）主要协议：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF。</p>
<p>数据链路层：主要任务是把网络层传下来的数据报组装成顺。数据链路层/链路层的传输单位是帧。功能：成帧（定义帧的开始和结束）、差错控制（帧错+位错）、流量控制、访问（接入）控制（控制对信道的访问）。主要协议：SDLC、HDLC、PPP、STP。</p>
<p>物理层：主要任务是在物理媒体上实现比特流的透明传输。物理层传输单位是比特。功能：定义接口特性、定义传输模式（单工、半双工、双工）、定义传输速率、比特同步、比特编码。主要协议：Rj45、802.3。</p>
<p>透明传输：指不管所传数据是什么样的比特组合，都应当能够在链路上传送。</p>
<h4 id="TCP-IP-参考模型"><a href="#TCP-IP-参考模型" class="headerlink" title="TCP/IP 参考模型"></a>TCP/IP 参考模型</h4><p><img src="https://blog.zhuangzhihao.top/img/tcpip.png" alt="TCP/IP"></p>
<p>TCP/IP vs ISO/OSI：</p>
<ul>
<li>都分层，都基于独立的协议栈的概念，都可以实现异构网络互联。</li>
<li>OSI 定义三点：服务、协议、接口，OSI 先出现，参考模型先于协议发明，不偏向特定协议，TCP/IP 设计之初就考虑到异构网互联问题，将 IP 作为重要层次。</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">ISO/OSI 模型</th>
<th style="text-align:center">TCP/IP 模型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">网络层</td>
<td style="text-align:center">无连接 + 面向连接</td>
<td style="text-align:center">无连接</td>
</tr>
<tr>
<td style="text-align:center">传输层</td>
<td style="text-align:center">面向连接</td>
<td style="text-align:center">无连接 + 面向连接</td>
</tr>
</tbody>
</table>
</div>
<p>5 层参考模型，综合了 OSI 和 TCP/IP 的优点：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">应用层</th>
<th style="text-align:center">支持各种网络应用 FTP、SMTP、HTTP</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">传输层</td>
<td style="text-align:center">进程-进程的数据传输 TCP、UDP</td>
</tr>
<tr>
<td style="text-align:center">网络层</td>
<td style="text-align:center">源主机到目的主机的数据分组路由与转发 IP、ICMP、OSPF等</td>
</tr>
<tr>
<td style="text-align:center">数据链路层</td>
<td style="text-align:center">把网络层传下来的数据报组装成帧 Ethernet、PPP</td>
</tr>
<tr>
<td style="text-align:center">物理层</td>
<td style="text-align:center">比特传输</td>
</tr>
</tbody>
</table>
</div>
<h3 id="二、物理层"><a href="#二、物理层" class="headerlink" title="二、物理层"></a>二、物理层</h3><h4 id="物理层基本概念"><a href="#物理层基本概念" class="headerlink" title="物理层基本概念"></a>物理层基本概念</h4><p>物理层接口特性：物理层解决如何在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层主要任务：确定与传输媒体接口有关的一些特性，定义标准。</p>
<ol>
<li>机械特性定义物理连接的特性，规定物理连接时所采用的规格、接口形状、引线数目、引脚数量和排列情况。</li>
<li>电气特性规定传输二进制位时，线路上信号的电压范围、阻抗匹配、传输速率和距离限制等。</li>
<li>功能特性指明某条线上出现的某一电平表示何种意义，接口部件的信号线的用途。</li>
<li>规程特性（过程特性）定义各条物理线路的工作规程和时序关系。</li>
</ol>
<h4 id="数据通信基础"><a href="#数据通信基础" class="headerlink" title="数据通信基础"></a>数据通信基础</h4><p><img src="https://blog.zhuangzhihao.top/img/计网01.png" alt="计网01"></p>
<p>通信的目的是传送消息（消息：语音、文字、图像、视频等）。数据通信指在不同计算机之间传输表示信息的二进制数0、1序列的过程。</p>
<p>数据（data）：传送信息的实体，通常是有意义的符号序列。信号：数据的电气/电磁的表现，是数据在传输过程中的存在形式。</p>
<p>数字信号/离散信号：代表消息的参数的取值是离散的。模拟信号/连续信号：代表消息的参数的取值是连续的。</p>
<p>信源：产生和发送数据的源头。信宿：接收数据的终点。信道：信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含条发送信道和一条接收信道。</p>
<p>信道按传输信号分模拟信道（传送模拟信号）和数字信道（传送数字信号），按传输介质分无线信道和有线信道，</p>
<p>从通信双方信息的交互方式看，可以有三种通信方式：</p>
<ol>
<li>单工通信：只有一个方向的通信而没有反方向的交互，仅需要一条信道。例如：广播。</li>
<li>半双工通信/双向交替通信：通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收需要两条信道。例如：对讲机。</li>
<li>全双工通信/双向同时通信：通信双方可以同时发送和接受信息，也需要两条信道。例如：打电话。</li>
</ol>
<p>按数据传输方式分为串行传输和并行传输：</p>
<ul>
<li>串行传输将表示一个字符的 8 位二进制数按由低位到高位的顺序依次发送。速度慢，费用低，适合远距离</li>
<li>并行传输将表示一个字符的 8 位二进制数同时通过 8 条信道发送，速度快，费用高，适合近距离，常用于计算机内部数据传输。</li>
</ul>
<p>按实现同步的传输/通信方式分为同步通信和异步通信：</p>
<ul>
<li>同步传输：在同步传输的模式下，数据的传送是以一个数据区块为单位，因此同步传输又称为区块传输。在传送数据时、需先送出 1 个或多个同步字符，再送出整批的数据。</li>
<li>异步传输：异步传输将比特分成小组进行传送，小组可以是 8 位的 1 个字符或更长。发送方可以在任何时刻发送这些比特组，而接收方不知道它们会在什么时候到达。传送数据时，加一个字符起始位和一个字符终止位。</li>
</ul>
<p>码元是指用一个固定时长的信号波形（数字脉冲），代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为 k 进制码元，而该时长称为码元宽度。当码元的离散状态有 M 个时（M 大于 2）此时码元为 M 进制码元。1 码元可以携带多个比特的信息量。例如，在使用二进制编码时，只有两种不同的码元，一种代表 0 状态，另一种代表 1 状态。</p>
<p>数字通信系统数据传输速率也叫数据率，是指数据的传输速率，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示：</p>
<ol>
<li><p>码元传输速率：别名码元速率、波形速率、调制速率、符号速率等，它表示单位时间内数字通信系统所传输的码元个数（也可称为脉冲个数或信号变化的次数），单位是波特（Baud）。1 波特表示数字通信系统每秒传输一个码元。例：若2秒内传4800个码元，码元传输速率是 2400B。数字信号有多进制和二进制之分，但码元速率与进制数无关，只与码元长度 T 有关。$R_{B}=\dfrac{1}{T}\left( B\right)$。</p>
</li>
<li><p>信息传输速率：别名信息速率、比特率等，表示单位时间内数字通信系统传输的二进制码元个数（即比特数），单位是比特/秒（b/s）。若一个码元携带 n bit 的信息量，则 M Baud 的码元传输速率所对应的信息传输速率为 $M×n$ bit/s。</p>
</li>
<li><p>一个 n 进制码元携带 $log_{2}{n}$ bit 信息量。 </p>
</li>
</ol>
<p>带宽（Bandwidth）：</p>
<ol>
<li>模拟信号系统中：当输入的信号频率高或低到一定程度，使得系统的输出功率成为输入功率的一半时（即 -3 dB），最高频率和最低频率间的差值就代表了系统的通频带宽，其单位为赫兹（Hz）。将模拟信号转换成数字信号时，采样频率必须大于等于最大频率 f 的 2 倍。</li>
<li>数字设备中：表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”/单位时间内通过链路的数量，常用来表示网络的通信线路所能传输数据的能力。单位是比特每秒（bps）。拥有更宽的带宽也就是有更大的信息运送能力。</li>
</ol>
<h4 id="奈氏准则和香农定理"><a href="#奈氏准则和香农定理" class="headerlink" title="奈氏准则和香农定理"></a>奈氏准则和香农定理</h4><p>码间串扰：失真的一种现象，接收端收到的信号波形失去了码元之间清晰界限的现象。影响失真程度的因素：码元传输速率、信号传输距离、噪声干扰、传输媒体质量。</p>
<p>奈奎斯特定理（奈氏准则）：在理想低通（无噪声，带宽受限）条件下，为了避免码间串扰，码元的最大传输速率为 2W Baud，W 表示理想低通信道的带宽，单位是 Hz，V 表示每个码元的离散电平的数目。</p>
<script type="math/tex; mode=display">
C_{\max }=2W\log _{2}V</script><ol>
<li>在任何信道中，码元传输的速率是有上限的。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别成为不可能。</li>
<li>信道的频带越宽（即能通过的信号高频分量越多），就可以用更高的速率进行码元的有效传输。</li>
<li>奈氏准则给出了码元传输速率的限制，但并没有对信息传输速率给出限制。</li>
<li>由于码元的传输速率受奈氏准则的制约，所以要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法。</li>
</ol>
<p>噪声存在于所有的电子设备和通信信道中。由于噪声随机产生，它的瞬时值有时会很大，因此噪声会使接收端对码元的判决产生错误。但是噪声的影响是相对的，若信号较强，那么噪声影响相对较小。因此，信噪比就很重要。信噪比是信号的平均功率和噪声的平均功率之比，信噪比 = 信号的平均功率/噪声的平均功率，常记为 S/N，单位：分贝 dB。</p>
<script type="math/tex; mode=display">
信噪比(dB)=10Iog_{10}{(\dfrac S N)}</script><p>香农定理：在带宽受限且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值。香农公式给出了信号传输速率的极限，W 为信道的带宽，单位 b/s。</p>
<script type="math/tex; mode=display">
C_{\max }=W \log _{2}\left( 1+\dfrac{S}{N}\right)</script><ol>
<li>信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。</li>
<li>对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了。</li>
<li>只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输。</li>
<li>香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少。</li>
<li>从香农定理可以看出，若信道带宽 W 或信噪比 S/N 没有上限（不可能），那么信道的极限信息传输速率也就没有上限。</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">奈氏准则</th>
<th style="text-align:center">香农定理</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">带宽受限无噪声条件下，为了避免码间串扰，码元传输速率的上限2 W Baud。</td>
<td style="text-align:center">带宽受限有噪声条件下的信息传输速率</td>
</tr>
<tr>
<td style="text-align:center">理想低通信道下的极限数据传输率 = $2Wlog_2V$</td>
<td style="text-align:center">信道的极限数据传输速率 = $W \log _{2}\left( 1+\dfrac{S}{N}\right)$</td>
</tr>
<tr>
<td style="text-align:center">要想提高数据率，就要提高带宽或采用更好的编码技术</td>
<td style="text-align:center">要想提高数据率，就要提高带宽或信噪比</td>
</tr>
</tbody>
</table>
</div>
<h4 id="编码与调制"><a href="#编码与调制" class="headerlink" title="编码与调制"></a>编码与调制</h4><p>信道：信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道。信道按传输信号分模拟信道（传送模拟信号）和数字信道（传送数字信号），按传输介质分无线信道和有线信道。</p>
<p>信道上传送的信号分为基带信号和宽带信号：</p>
<ul>
<li>基带信号将数字信号 1 和 0 直接用两种不同的电压表示，再送到数字信道上去传输（基带传输）。来自信源的信号，像计算机输出的代表各种文字或图像文件的数据信号都属于基带信。基带信号就是发出的直接表达了要传输的信息的信号，比如我们说话的声波就是送的信号基带信号。</li>
<li>宽带信号将基带信号进行调制后形成的频分复用模拟信号，再传送到模拟信道上去传输（宽带传输）。把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一段频率范围内能够通过信道)。</li>
<li>在传输距离较近时，计算机网络采用基带传输方式（近距离衰减小，从而信号内容不易发生变化）。在传输距离较远时，计算机网络采用宽带传输方式（远距离衰减大，即使信号变化大也能最后过滤出来基带信号）。</li>
</ul>
<p><img src="https://blog.zhuangzhihao.top/img/计网02.png" alt="计网02"></p>
<p>数字数据编码为数字信号：</p>
<ol>
<li>非归零编码【NRZ】：高 1 低 0，编码容易实现，但没有检错功能且无法判断一个码元的开始和结束，以至于收发双方难以保持同步。</li>
<li>归零编码【RZ】：信号电平在一个码元之内都要恢复到零的这种编码成编码方式。</li>
<li>反向不归零编码【NRZI】信号电平翻转表示 0，信号电平不变表示 1。</li>
<li>曼彻斯特编码：将一个码元分成两个相等的间隔，前一个间隔为低电平，后一个间隔为高电平表示码元 1；码元 0 则正好相反。也可以采用相反的规定。该编码的特点是在每一个码元的中间出现电平跳变，位中间的跳变既作时钟信号（可用于同步）又作数据信号，但它所占的频带宽度是原始的基带宽度的两倍。每一个码元都被调成两个电平，所以数据传输速率只有调制速率的 1/2。</li>
<li>差分曼彻斯特编码：同 1 异 0，常用于局域网传输，其规则是：若码元为 1，则前半个码元的电平与上一个码元的后半个码元的电平相同，若为 0，则相反。该编码的特点是，在每个码元的中间，都有一次电平的跳转，可以实现自同步，且抗干扰性强于曼彻斯特编码。</li>
<li>4B/5B 编码：比特流中插入额外的比特以打破一连串的 0 或 1，就是用 5 个比特来编码 4 个比特的数据，之后再传给接收方，因此称为 4B/5B。编码效率为 80%。</li>
</ol>
<p><img src="https://blog.zhuangzhihao.top/img/计网03.png" alt="计网03"></p>
<p>数字数据调制为模拟信号：数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应于调制解调器的调制和解调过程。分类：调幅（ASK），调频（FSK），调相（PSK），调幅 + 调相（QAM）。</p>
<p>模拟数据编码为数字信号：计算机内部处理的是二进制数据，处理的都是数字音频，所以需要将模拟音频通过采样、量化转换成有限个数字表示的离散序列（即实现音频数字化），最典型的例子就是对音频信号进行编码的脉码调制（PCM），在计算机应用中，能够达到最高保真水平的就是 PCM 编码，被广泛用于素材保存及音乐欣赏，CD、DVD 以及我们常见的 WAV 文件中均有应用。它主要包括三步抽样、量化、编码。</p>
<ol>
<li>抽样：对模拟信号周期性扫描，把时间上连续的信号变成时间上离散的信号。为了使所得的离散信号能无失真地代表被抽样的模拟数据，要使用采样定理进行采样：$f<em>{采样频率} ≥ 2f</em>{信号最高频率}$。</li>
<li>量化：把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值，并取整数，这就把连续的电平幅值转换为离散的数字量。</li>
<li>编码：把量化的结果转换为与之对应的二进制编码。</li>
</ol>
<p>模拟数据调制为模拟信号：为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用技术，充分利用带宽资源。在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式；模拟的声音数据是加载到模拟的载波信号中传输的。</p>
<h4 id="数据交换方式"><a href="#数据交换方式" class="headerlink" title="数据交换方式"></a>数据交换方式</h4><p>交换是通过某些交换中心将数据进行集中和传送。传输线路为各个用户共用，从而大大节省通信线路，降低系统费用。</p>
<p>数据传输方式包括电路交换、报文交换和分组交换。</p>
<p>电路交换：在数据传输期间，源结点与目的结点之间有一条由中间结点构成的专用物理连接线路，在数据传输结束之前，这条线路一直保持。电路交换一定面向连接。通信时延小、实时性强、有序传输，但信道利用率低、缺乏统一标准、灵活性差。特点：独占资源，用户始终占用端到端的固定传输带宽，适用于远程批处理信息传输或系统间实时性要求高的大量数据传输的情况。</p>
<p>报文交换：报文（message）是网络中交换与传输的数据单元，即站点一次性要发送的数据块。报文包含了将要发送的完整的数据信息，其长短很不一致，长度不限且可变。报文携带有目的地址、源地址。报文交换无需在两个站点之间建立一条专用通路，其数据传输的单位是报文，传送过程采用存储转发方式。无需建立连接、动态分配线路，但报文大小没限制，要求网络节点需要有较大的存储缓存空间。</p>
<p>分组交换（Package exchanging）：大多数计算机网络都不能连续地传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块就称作分组（packet）。分组交换与报文交换的工作方式基本相同，都采用存储转发方式，形式上的主要差别在于，分组交换网中要限制所传输的数据单位的长度，一般选 128B。发送节点首先对从终端设备送来的数据报文进行接收、存储，而后将报文划分成一定长度的分组，并以分组为单位进行传输和交换。接收结点将收到的分组组装成信息或报文。将一个长报文分割成若干个较短的分组。加速传输、简化存储管理、减少出错概率和重发数据量，但存在传输时延、可能出现失序、丢失或重复分组现象。小数据块 + 控制信息（源和目的地址、编号）= 分组。</p>
<p>数据交换方式选择：</p>
<ol>
<li>传送数据量大，且传送时间远大于呼叫时，选择电路交换。电路交换传输时延最小。</li>
<li>当端到端的通路有很多段的链路组成时，采用分组交换传送数据较为合适。</li>
<li>从信道利用率上看，报文交换和分组交换优于电路交换，其中分组交换比报文交换的时延小，尤其适合于计算机之间的突发式的数据通信。</li>
</ol>
<p>分组交换可分为面向连接的虚电路方式和面向无连接的数据报方式，二者都由网络层提供：</p>
<ul>
<li><p>数据报方式：源主机将报文分成多个分组，依次发送到直接相连的结点；结点收到分组后，对每个分组差错检测和路由选择，不同分组的下一跳结点可能不同；下一结点收到分组后，对分组进行差错检测，若正确则向源主机发送确认信息，源主机收到结点确认后则丢弃分组副本。数据报无需建立连接、提高吞吐量、对故障适应力强，每个分组包含完整的源地址和目的地址，可靠通信由用户主机来保证。</p>
<ol>
<li>数据报方式为网络层提供无连接服务。发送方可随时发送分组，网络中的结点可随时接收分组。</li>
<li>同一报文的不同分组达到目的结点时可能发生乱序、重复与丢失。</li>
<li>每个分组在传输过程中都必须携带源地址和目的地址，以及分组号。</li>
<li>分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。当通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组。</li>
<li>网络具有冗余路径，当某一交换结点或一段链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，对故障的适应能力强，适用于突发性通信，不适于长报文、会话式通信。</li>
</ol>
</li>
<li><p>虚电路将数据报方式和电路交换方式结合，以发挥两者优点。一条源主机到目的主机类似于电路的路径（逻辑连接），路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表，每一项记录了一个打开的虚电路的信息。虚电路时延小、按序到达，每个分组包含一个虚电路号，可靠通信由网络来保证。</p>
<ol>
<li>虚电路方式为网络层提供连接服务。源节点与目的结点之间建立一条逻辑连接，而非实际物理连接。</li>
<li>一次通信的所有分组都通过虚电路顺序传送，分组不需携带源地址、目的地址等信息，包含虚电路号，相对数据报方式开销小，同一报文的不同分组到达目的结点时不会乱序、重复或丢失。</li>
<li>分组通过虚电路上的每个节点时，节点只进行差错检测，不需进行路由选择。</li>
<li>每个节点可能与多个节点之间建立多条虚电路，每条虚电路支持特定的两个端系统之间的数据传输，可以对两个数据端点的流量进行控制，两个端系统之间也可以有多条虚电路为不同的进程服务。</li>
<li>致命弱点：当网络中的某个结点或某条链路出故障而彻底失效时，则所有经过该结点或该链路的虚电路将遭到破坏。</li>
</ol>
</li>
</ul>
<p>无连接服务：不事先为分组的传输确定传输路径，每个分组独立确定传输路径，不同分组传输路径可能不同。连接服务：首先为分组的传输确定传输路径（建立连接），然后沿该路径（连接）传输系列分组系列分组传输路径相同，传输结束后拆除连接。</p>
<p>TCP 可以向应用层提供面向连接的服务，而 UDP 在传输层是无连接的。</p>
<h4 id="传输介质和物理层设备"><a href="#传输介质和物理层设备" class="headerlink" title="传输介质和物理层设备"></a>传输介质和物理层设备</h4><p>传输介质也称传输媒体/传输媒介，它就是数据传输系统中在发送设备和接收设备之间的物理通路。传输介质并不是物理层，传输媒体在物理层的下面，因为物理层是体系结构的第一层，因此有时称传输媒体为 0 层。在传输媒体中传输的是信号，但传输媒体并不知道所传输的信号代表什么意思。但物理层规定了电气特性，因此能够识别所传送的比特流。物理层主要的功能就是确定与传输介质的接口有关的一些特性，即物理层接口的特性，如机械特性、电气特性、功能特性、规程特性。</p>
<p>传输介质分为导向性传输介质（电磁波被导向沿着固体媒介（铜线/光纤）传播）和非导向性传输介质（自由空间，介质可以是空气、真空、海水等）。</p>
<p>导向性传输介质包含双绞线、同轴电缆和光纤。</p>
<ul>
<li><p>双绞线是古老、又最常用的传输介质，它由两根采用一定规则并排绞合的、相互绝缘的铜导线组成。绞合可以减少对相邻导线的电磁干扰。为了进一步提高抗电磁干扰能力，可在双绞线的外面再加上一个由金属丝编织成的屏蔽层，这就是屏蔽双绞线（STP），无屏蔽层的双绞线就称为非屏蔽双绞线（UTP）。双绞线价格便宜，是最常用的传输介质之一，在局域网和传统电话网中普遍使用。模拟传输和数字传输都可以使用双绞线，其通信距离一般为几公里到数十公里。距离太远时，对于模拟传输，要用放大器放大衰减的信号；对于数字传输，要用中继器将失真的信号整形。</p>
</li>
<li><p>同轴电缆由导体铜质芯线、绝缘层、网状编织屏蔽层和塑料外层构成。按特性阻抗数值的不同，通常将同轴电缆分为两类：50Ω 同轴电缆和 75Ω 同轴电缆。其中，50Ω 同轴电缆主要用于传送基带数字信号，又称为基带同轴电缆，它在局域网中得到广泛应用；75Ω 同轴电缆主要用于传送宽带信号，又称为宽带同轴电缆，它主要用于有线电视系统。由于外导体屏蔽层的作用，同轴电缆抗干扰特性比双绞线好，被广泛用于传输较高速率的数据，其传输距离更远，但价格较双绞线贵。</p>
</li>
<li><p>光纤通信就是利用光导纤维（简称光纤）传递光脉冲来进行通信。有光脉冲表示 1，无光脉冲表示 0。而可见光的频率大约是 10MHz，因此光纤通信系统的带宽远远大于目前其他各种传输媒体的带宽。光纤在发送端有光源，可以采用发光二极管或半导体激光器，它们在电脉冲作用下能产生出光脉冲；在接收端用光电二极管做成光检测器，在检测到光脉冲时可还原出电脉冲。光纤主要由实心的纤芯和包层构成，光波通过纤芯进行传导，包层较纤芯有较低的折射率。当光线从高折射率的介质射向低折射率的介质时，其折射角将大于入射角。因此，如果入射角足够大，就会出现全反射，即光线碰到包层时候就会折射回纤芯、这个过程不断重复，光也就沿着光纤传输下去。</p>
<p>光纤传输损耗小，中继距离长，对远距离传输特别经济。抗雷电和电磁干扰性能好无串音干扰，保密性好，也不易被窃听或截取数据。体积小，重量轻。</p>
</li>
<li><p>光纤分为单模光纤（一种在横向模式接传输光信号的光纤，衰耗小，适合远距离传输，光源：定向性很好的激光二极管）和多模光纤（有多种传输光信号模式的光纤，易失真，适合近距离传输，光源：发光二极管）。</p>
</li>
</ul>
<p>非导向性传输介质有短波、微波、红外线与可见光等。</p>
<ul>
<li>无线电波：较强穿透能力，可传远距离，广泛用于通信领域（如手机通信)。信号向所有方向传播。</li>
<li>微波：微波通信频率较高、频段范围宽，因此数据率很高。信号向固定方向传播。分地面微波接力通信和卫星通信（通信容量大、距离远、覆盖广、广播通信和多址通信、但传播时延长（250-270ms）、受气候影响大（强风、太阳黑子爆发、日凌）、误码率较高、成本高）。</li>
<li>红外线、激光：把要传输的信号分别转换为各自的信号格式，即红外光信号和激光信号，信号再在空间中传播。向固定方向传播。</li>
</ul>
<p>物理层设备主要包含中继器和集线器。放大器放大的是模拟信号，中继器放大的是数字信号。</p>
<p>中继器：对信号进行再生和还原，对衰减的信号进行放大，保持与原数据相同，以增加信号传输的距离，延长网络的长度。</p>
<ul>
<li>中继器的两端的网络部分是网段，而不是子网，适用于完全相同的两类网络的互连，且两个网段速率要相同。中继器只将任何电缆段上的数据发送到另一段电缆上，它仅作用于信号的电气部分，并不管数据中是否有错误数据或不适于网段的数据。两端可连相同媒体，也可连不同媒体。中继器两端的网段一定要是同一个协议。（中继器不会存储转发，傻）</li>
<li>5-4-3规则：网络标准中都对信号的延迟范围作了具体的规定，因而中继器只能在规定的范围内进行，否则会网络故障。</li>
</ul>
<p>集线器实际就是一个多端口的中继器（Hub）。集线器在一个时钟周期内只能传输一组信息。集线器不能隔离冲突域，连在集线器上的工作主机平分带宽。</p>
<p>集线器的功能：对信号进行再生放大转发，对衰减的信号进行放大，接着转发到其他所有（除输入端口外）处于工作状态的端口上，以增加信号传输的距离，延长网络的长度。不具备信号的定向传送能力，是一个共享式设备。</p>
<p>通过中继器或集线器连接起来的几个网段仍然是一个局域网。使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用 CSMA/CD 协议，共享逻辑上的总线。</p>
<h3 id="三、数据链路层"><a href="#三、数据链路层" class="headerlink" title="三、数据链路层"></a>三、数据链路层</h3><h4 id="数据链路层的功能"><a href="#数据链路层的功能" class="headerlink" title="数据链路层的功能"></a>数据链路层的功能</h4><p>结点：主机、路由器</p>
<p>链路：网络中两个结点之间的物理通道，链路的传输介质主要有双绞线、光纤和微波。分为有线链路、无线链路。</p>
<p>数据链路：网络中两个结点之间的逻辑通道，把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路。</p>
<p>帧：链路层的协议数据单元，封装网络层数据报。</p>
<p>数据链路层负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送数据报。</p>
<p>数据链路层在物理层提供服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据可靠地传输到相邻节点的目标机网络层。其主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。</p>
<ul>
<li>功能一：为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。有连接一定有确认！</li>
<li>功能二：链路管理，即连接的建立、维持、释放（用于面向连接的服务）。</li>
<li>功能三：组帧。</li>
<li>功能四：流量控制。限制发送方。</li>
<li>功能五：差错控制（帧错/位错）。</li>
</ul>
<h4 id="组帧（封装成帧）和透明传输"><a href="#组帧（封装成帧）和透明传输" class="headerlink" title="组帧（封装成帧）和透明传输"></a>组帧（封装成帧）和透明传输</h4><p>当 2 个主机互相传送信息时，网络层的分组（IP 数据报）必须封装成帧，并以帧的格式进行传送。封装成帧就是在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。首部和尾部包含许多的控制信息，他们的一个重要作用：帧定界（确定帧的界限）。帧的数据部分 ≤ 最大传送单元 MTU。</p>
<p>帧同步：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。</p>
<p>组帧方法分为字符计数法、字符填充法（字节填充的首尾界符法）、零比特填充法（比特填充的首尾标志法）、违规编码法（物理编码违例法）。</p>
<ol>
<li>字符计数法：帧首部使用一个计数字段（第一个字节，八位）来标明帧内字符数。</li>
<li>字符填充法：选定 2 个字符（SOH/EOT）作为每一个帧的开始和结束。字符填充的首尾界符法是将数据中可能出现的控制字符<code>SOH</code>和<code>EOT</code>在接收端不解释为控制字符。当传送的帧是由文本文件组成时（文本文件的字符都是从键盘上输入的，都是 ASCII 码），不管从键盘上输入什么字符都可以放在帧里传过去，即透明传输。当传送的帧是由非 ASCII 码的文本文件组成时（二进制代码的程序或图像等），就要采用字符填充方法实现透明传输。</li>
<li>零比特填充法：使用 <code>01111110</code> 作为帧的开始和结束标志。在发送端。每有 5 个连续的 <code>1</code> 马上在其后插入 <code>0</code>。在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描，每收到 5个连续的 <code>1</code> 自动删除后面紧跟的 <code>0</code> 恢复原始数据。保证了透明传输：在传送的比特流中可以传送任意比特组合，而不会引起对帧边界的判断错误。</li>
<li>物理编码违例法利用物理介质上的编码的违法标志来区分帧的开始和结束，例如在曼彻斯特编码中高 - 高和低 - 低电平的编码方式是无效的，用来作为帧的起始和结束标志。由于字节计数法中 Count 字段的脆弱性（其值若有差错将导致灾难性后果）及字符填充实现上的复杂性和不兼容性，目前较普遍使用的帧同步法是比特填充和违规编码法。</li>
</ol>
<p>透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。因此，链路层就“看不见”有什么妨碍数据传输的东西。当所传数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输是透明的。</p>
<h4 id="差错控制（检错编码）"><a href="#差错控制（检错编码）" class="headerlink" title="差错控制（检错编码）"></a>差错控制（检错编码）</h4><p>传输中的差错都是由于噪声引起的。全局性：由于线路本身电气特性所产生的随机噪声（热噪声），是信道固有的，随机存在的。解决办法是提高信噪比来减少或避免干扰（对传感器下手）。局部性：外界特定的短暂原因所造成的冲击噪声，是产生差错的主要原因。解决办法通常利用编码技术来解决。</p>
<p>差错分为：位错（比特位出错，1 变成 0，0 变成 1）和帧错（丢失、重复、失序）。差错控制（比特错）分为检错编码和纠错编码。</p>
<p>检错编码分为奇偶校验码和循环冗余码（CRC）。</p>
<p>数据链路层编码和物理层的数据编码与调制不同。物理层编码针对的是单个比特，解决传输过程中比特的同步等问题，如曼彻斯特编码。而数据链路层的编码针对的是一组比特，它通过冗余码的技术实现一组二进制比特串在传输过程是否出现了差错。</p>
<p>冗余编码：在数据发送之前，先按某种关系附加上一定的冗余位，构成一个符合某一规则的码字后再发送当要发送的有效数据变化时，相应的冗余位也随之变化，使码字遵从不变的规则。接收端根据收到码字是否仍符合原规则，从而判断是否出错。</p>
<p>奇偶校验码是在信息码后面加 1 位校验码，分为奇校验和偶校验。奇校验是添加 1 位校验码后使得整个码字里面<code>1</code>的个数是奇数。奇偶校验码特点：只能检查出奇数个比特错误，检错能力为 50%。</p>
<p>循环冗余码（CRC）是在发送端产生一个冗余码，附加在信息位后面一起发送到接收端，接收端收到的信息按发送端形成循冗余码同样的算法进行校验，如果发现错误则通知发送端重发。</p>
<ul>
<li>计算冗余码：先加 0（假设生成多项式 G(x) 的阶为 r，则加 r 个 0）。再模 2 除法（数据加 0 后除以多项式，余数为冗余码 FCS）。多项式为 n 位，阶 r = n - 1。</li>
<li>CRC 的本质是模 2 除法（异或，同 0 异 1，加法不进位，减法不退位）的余数，采用的除数不同，CRC 的类型也就不一样。</li>
<li>接收端检错过程：把收到的每一个帧都除以同样的除数，然后检查得到的余数。余数为 0，判定这个帧没有差错，接受。余数为不为 0，判定这个帧有差错（无法确定到位），丢弃。</li>
<li>FCS 的生成以及接收端 CRC 检验都是由硬件实现，处理很迅速因此不会延误数据的传输。</li>
<li>循环冗余码具有 r 检测位的多项式能够检测出所有小于或等于 r 的突发错误，长度大于 r+1 的错误逃脱的概率是 $\dfrac{1}{2^{r}}$。</li>
</ul>
<p>常见的纠错编码是海明码，在 m 位信息字段中插入若干位数据用于监督码字里的哪一位数据发生变化，具有一位纠错能力。两个合法编码（码字）的对应比特取值不同的比特数称为这两个码字的海明距离（码距），一个有效编码集中，任意两个合法编码（码字）的海明距离的最小值称为该编码集的海明距离（码距）。</p>
<ol>
<li>确认校验码的位数 r：$2^{r}-1\geq m+r$。</li>
<li>校验码 $P_i$ 在编码中的位置为 $2^{i-1}$。</li>
<li>出错位 $e_n$ 等于所有有关位 $M_n$ 互为异或，求出 $P_i$，按序写出海明码。</li>
<li>校验海明码：出错位 $e_n$ 等于所有有关位 $M_n$ 互为异或，求出 $e_n$。</li>
<li>出错位 $e_n$ 对应的十进制数就是出错的位数。</li>
</ol>
<h4 id="流量控制与可靠传输机制"><a href="#流量控制与可靠传输机制" class="headerlink" title="流量控制与可靠传输机制"></a>流量控制与可靠传输机制</h4><p>流量控制就是要控制发送方发送数据的速率使接收方来得及接收，分为停止-等待流量控制和滑动窗口流量控制。</p>
<ul>
<li>停止-等待流量控制就是发送方发出一帧，等接收方收到一帧后返回应答信号，再发送下一帧。</li>
<li>滑动窗口流量控制允许一次发送多个帧。在任意时刻发送方都维持一组连续的允许发送的帧的序号，称为发送窗口。同时接收方也维持一组连续的允许接收帧的序号，称为接收窗口。发送端每收到一个帧的确认，发送窗口就向前移动1个帧的位置。</li>
<li>只有在接收窗口向前滑动时，发送窗口才有可能向前滑动。</li>
<li><p>只要当接收窗口大小为1时，则可保证帧按序接受。</p>
</li>
<li><p>端到端的可靠传输就是在传输层使用面向连接的TCP，而不是数据链路层。</p>
</li>
<li>可靠传输一般使用确认和超时重传两种机制共同完成（ARQ自动请求重发）。</li>
<li>可靠传输机制包括停止-等待协议、后退N帧协议和选择重传协议。<ul>
<li>停止等待协议就是发送窗口和接收窗口大小均为1。帧一般分为数据帧和确认帧。</li>
<li>后退N帧协议：发送方连续发送若干个数据帧，如果收到接收方的确认帧接着发送数据，如果某个帧出错，接收方只能简单丢弃该帧及后续所有帧。增加吞吐量，但造成一定浪费。</li>
<li>后退N帧协议接收窗口大小=1，$1&lt;发送窗口大小W_{T}\leq 2^{n}-1$。n为对帧编号的比特数。</li>
<li>选择重传（SR）协议：当一帧出错时，后续帧先存入接收方的缓冲区中,同时要求发送方重传出错帧。提高信道利用率但增加缓冲空间。</li>
<li>选择重传协议的接收窗口尺寸和发送窗口尺寸都大于1，以便能一次性接受多个帧。发送窗口的最大尺寸也不能超过序列号范围的一半。当发送窗口等于接收窗口=$2^{n}-1$时达到最大效率。</li>
<li>按序到达的且没有被交付给主机的帧被放在接收缓存里。不按序到达的数据且没有错误的帧放在接收窗口里。不直接给主机，等缺少的帧收到后再一起放到接收缓存。</li>
</ul>
</li>
</ul>
<h4 id="介质访问控制"><a href="#介质访问控制" class="headerlink" title="介质访问控制"></a>介质访问控制</h4><ul>
<li>静态分配信道的方法是信道划分介质访问控制。动态分配信道的方法分为随机访问介质访问控制和轮询访问介质访问控制。</li>
<li>多路复用技术是在一条介质上同时携带多个传输信号，使多个计算机或终端设备共享信道资源，提高信道的利用率。实现信道划分介质访问控制。</li>
<li>信道划分介质访问控制分为频分多路复用、时分多路复用、波分多路复用和码分多路复用。<ul>
<li>频分多路复用时如果复用数增加，那么信号的频率带宽增加。</li>
<li>统计时分复用是一种动态的时间分配。</li>
<li>波分多路复用就是光的频分多路复用。</li>
<li>码分多路复用，又称为码分多址（CDMA），既共享信道的频率又共享时间，主要用于无线通信系统。</li>
<li>任意2个站点的码片向量的规格化内积一定为1。任意站点的码片向量与该码片向量自身的规格化内积一定为1。任何站点的码片向量和该码片的反码向量的规格化内积一定为负1。</li>
</ul>
</li>
<li>动态划分信道分为随机接入（争用性协议）和受控接入。<ul>
<li>ALOHA协议：不检测发送数据，一段时间没收到确认即为发送冲突，发生冲突的节点等待一段随机事件后再发送数据。</li>
<li>时分ALOHA：所有节点的时间被划分为间隔相同的时隙，并规定每个节点就会等到下一个时隙到来时才可发送数据。</li>
<li>载波侦听多路访问（CSMA）协议：每个节点发送数据之前，都使用载波侦听技术来判定通信信道是否空闲，在局域网中被广泛的应用。</li>
<li>1-坚持CSMA：监听到信道空闲时，立即发送数据，否则继续监听。</li>
<li>p-坚持CSMA：监听到信道空闲时，以概率P发送数据，以概率(1-P)延迟一段时间并重新监听。</li>
<li>非坚持CSMA。监听到信道空闲时，立即发送数据，否则延迟一段随机的时间再重新监听。</li>
<li>CSMA/CD协议（带冲突检测的载波侦听多路访问协议）：检测超过发送站点本身发送的载波信号的幅度，由此判断出冲突的存在，并向总线上发一串阻塞信号。</li>
<li>CSMA/CD工作流程：先听后发，边听边发，冲突停发，随机重发。</li>
<li>CSMACD用于信道使用半双工的网络环境，而对于使用全双工的网络环境，则无需采用这种介质访问控制技术。</li>
<li>争用期（$2\tau$）：以太网端到端的往返时延，又称冲突窗口或碰撞窗口。只有经过争用期还没有检测到冲突，才能肯定这次发送不会发生冲突。</li>
<li>以太网规定最短帧长为64B，凡长度小于64B的都是由于冲突而异常停止的无效帧。以太网端到端的单程时延实际上小于争用期的一半（25.6μs）。</li>
<li>最短有效帧长和最远2个站的距离及传输速率成正比。</li>
<li>截断二进制指数类型退避算法：发生碰撞的站在停止发送数据后要推迟一个随机时间才能发送数据，基本退避时间一般取争用期（$2\tau$），重传需要推迟的平均时间随重传次数的增大而增大。</li>
<li>CSMA/CA协议主要用在无线局域网中，在CSMA的基础上增加了冲突避免的功能。</li>
<li>CSMA/CA协议要对正确接收到的数据帧进行确认。</li>
</ul>
</li>
<li>轮询访问介质访问控制主要用于在令牌环局域网中。典型的轮询访问介质访问控制协议就是令牌传递协议。</li>
</ul>
<h4 id="局域网"><a href="#局域网" class="headerlink" title="局域网"></a>局域网</h4><ul>
<li>局域网（local area network，LAN）是指一个较小范围内的多台计算机或其他通信设备通过双绞线、同轴电缆等连接介质互联起来，以达到资源和信息共享目的的互联网络。<ul>
<li>局域网有较高的数据率、较低的时延和较小的误码率，具有广播功能，便于系统的扩展和演变。</li>
<li>局域网的主要技术要素包括网络拓扑结构传输介质与介质访问控制方法。局域网的主要拓扑结构包括星型网环形网总线型网和树型网（星型网和总线型网的结合）。双绞线为局域网的主流传输介质。</li>
<li>局域网的主要介质访问控制方法包括CSMA/CD、令牌总线和令牌环。前两种作用于总线型网，令牌环作用于环形网。</li>
<li>局域网对应OSI参考模型中的数据链路层和物理层，并将数据链路层拆分为2个子层，逻辑链路控制（LLC）子层和媒体接入控制（MAC）子层。</li>
</ul>
</li>
<li>以太网采用总线拓扑结构。所有计算机都共享一条总线信息，以广播方式发送，使用CSMACD技术对总线进行访问控制。<ul>
<li>以太网采用无连接的工作方式，不对发送的数据帧进行编号，也不要求对发送方发送确认。以太网提供的服务是不可靠服务，所以有重传机制，且差错纠正由传输层的TCP完成。</li>
<li>数据传输速率达到或超过100Mbit/s的以太网称为高速以太网。100base-T以太网称为快速以太网。吉比特以太网成为千兆以太网,允许在全双工和半双工两种方式工作。在半双工方式下工作时必须使用CSMA/CD协议进行冲突检测。</li>
</ul>
</li>
<li>无线局域网分为有固定基础设施和无固定基础设施两类。IEEE802.11规定有固定基础设施的无线局域网的最小构建为基本服务集（BSS），BSS中的基站称为接入点（AP）。<ul>
<li>基本服务集可以是孤立的，也可以通过接入点连接到一个主干分配系统（DS）构成扩展的服务器（ESS），ESS还可通过门桥（portal）设备为无线用户提供到非IEEE802.11无线局域网的接入。</li>
<li>IEEE802.11标准中的物理层有跳频扩频（FHSS）、直接序列扩频（DSS）、红外线（IR）3种实现方法。</li>
<li>IEEE802.11标准中的MAC层在物理层上，包括2个子层，从下往上依次为分布协调功能（DCF）子层和点协调功能（PCF）子层。在带有碰撞避免功能的CSMA/CA协议的基础上增加确认机制。</li>
</ul>
</li>
<li>广域网是覆盖范围很广的长距离网络，由一些节点交换机以及连接这些交换机的链路组成。节点交换机完成分组存储转发的功能。<ul>
<li>广域网是通过交换机连接多个局域网组成，因特网是由广域网和局域网共同通过路由器相连。</li>
<li>局域网使用的协议主要在数据链路层，而广域网使用的协议主要在网络层。</li>
<li>广域网的路由选择协议负责搜索分组从某个节点到目的节点的最佳传输路由，以便构成路由表，从路由表再构造出转发分组的转发表，分组是通过转发表进行转发的。</li>
</ul>
</li>
<li>点对点协议（PPP）由一个将IP数据报封装到串行链路的方法、一个用于建立配置和测试数据链路连接的链路控制协议（LCP）和一套用来建立和配置不同的网络层协议的网络控制协议（NCP），其中每个协议支持不同的网络层协议。<ul>
<li>PPP是一个面向字节的协议，不需要纠错（只负责检错）、流量控制（由TCP负责）、序号（不可靠的传输协议）、多点线路，只支持全双工链路。</li>
</ul>
</li>
<li>高级数据链路控制（HDLC）协议是ISO制定的面向比特的数据链路控制协议，可适用于链路的非平衡配置（一个主站控制整个链路的工作）和平衡配置（链路两端2个站都是复合站）。<ul>
<li>PPP帧比HDLC协议帧多一个2字节的协议字段，当协议字段值为Ox0021时表示信息字段是IP数据报。</li>
<li>PPP不使用序号和确认机制，只保证无差错接收（通过硬件进行循环冗余码校验），HDLC协议的信息帧使用了编号和确认机制。</li>
</ul>
</li>
</ul>
<h4 id="数据链路层设备"><a href="#数据链路层设备" class="headerlink" title="数据链路层设备"></a>数据链路层设备</h4><ul>
<li>在物理层拓展局域网使用中继器和集线器扩大冲突域，但总吞吐量未提高，且不能互联使用不同以太网技术的局域网。</li>
<li>在数据链路层扩展局域网使用网桥，具有过滤帧的功能。网桥至少有2个端口，每一个端口与一个网段相连。<ul>
<li>网桥从一个端口接收一个帧，先暂存到缓存中，若未出现差错，且发往目的站MAC地址属于另一网段，则通过查找转发表将该帧从对应端口发出。</li>
<li>网桥过滤通信量、扩大物理范围、提高可靠性、可互连不同物理层、不同MAC子层和不同速率的以太网，但存储转发增加时延，且在MAC层并没有流量控制功能，用户过多会因传播过多的广播信息而产生网络拥塞（广播风暴）。</li>
<li>网桥包括透明网桥（选择的不是最佳路由）和源选径网桥（选择的是最佳路由）。最佳路由并不一定是经过路由器最少的路由，也可以是发送帧往返时间最短的路由（实现负载平衡）。</li>
</ul>
</li>
<li>局域网交换机实质上是工作在数据链路层的多端口网桥。局域网交换机的每个端口都直接与主机或集线器相连，并且一般都工作在全双工方式。<ul>
<li>交换机总容量 = 端口数×每个端口带宽（半双工）or 端口数×每个端口带宽×2（全双工）</li>
<li>交换机分为直通式交换和存储转发式交换，工作原理与网桥类似。</li>
<li>网桥的端口一般连接到局域网的网段，而以太网交换机的每个端口一般都直接与主机相连，也可连接到Hub。</li>
</ul>
</li>
<li>一块网卡发出一个广播，能收到这个广播的所有网卡集合为一个广播域。通常情况下，一个网段就是一个冲突域，一个局域网就是一个广播域。</li>
</ul>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><h4 id="网络层提供的两种服务"><a href="#网络层提供的两种服务" class="headerlink" title="网络层提供的两种服务"></a>网络层提供的两种服务</h4><ul>
<li>网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务，并且网络层不提供服务质量的承诺。</li>
<li>这样的好处在于网络造价大大降低，运行方式灵活。</li>
</ul>
<h4 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a>网际协议IP</h4><ul>
<li>网际协议IP是TCP/IP体系中两个最主要的协议之一。其中，与IP协议配套使用的有三种协议：<ul>
<li>地址解析协议ARP</li>
<li>网际控制报文协议ICMP</li>
<li>网际组管理协议IGMP</li>
</ul>
</li>
<li>其中，ICMP、IGMP协议是往基层向上提供的两种服务</li>
</ul>
<h4 id="互联网络"><a href="#互联网络" class="headerlink" title="互联网络"></a>互联网络</h4><ul>
<li>因为用户的需求是多种多样的，没有一种单一的网络能够适应所有用户的需求,所以不同的网络之间，将网络互联起来需要使用一些中间设备。<ul>
<li>物理层使用的中间设备是转发器</li>
<li>数据链路层使用的中间设备是网桥或者桥接器</li>
<li>网络层使用的中间设备是路由器</li>
<li>网络层以上使用的中间设备叫网关</li>
</ul>
</li>
</ul>
<h5 id="IP地址与硬件地址"><a href="#IP地址与硬件地址" class="headerlink" title="IP地址与硬件地址"></a>IP地址与硬件地址</h5><ul>
<li><p>物理地址是数据链路层和物理层使用的地址，而IP地址是网络层和网络层以上各层使用的地址</p>
</li>
<li><p>在发送数据时，数据从高层下到底层，然后才到通信链路上使用IP的IP数据报一旦交给了数据链路层，就被封装成MAC帧（MAC地址）</p>
</li>
</ul>
<h5 id="地址解析协议ARP"><a href="#地址解析协议ARP" class="headerlink" title="地址解析协议ARP"></a>地址解析协议ARP</h5><ul>
<li><p>已知一个机器的IP地址，如何找出其所对应的硬件地址呢？这就是ARP的主要任务。</p>
<ul>
<li>ARP协议的主要内容在于从网络层使用的IP地址，解析出在数据链路层使用的硬件地址。</li>
</ul>
</li>
</ul>
<ul>
<li>工作原理：一个主机都设有一个ARP高速缓存，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。</li>
</ul>
<h4 id="IP数据报"><a href="#IP数据报" class="headerlink" title="IP数据报"></a>IP数据报</h4><ul>
<li>一个IP数据报由首部（20 字节+可选字段）和数据两部分组成</li>
</ul>
<h4 id="划分子网和构建超网"><a href="#划分子网和构建超网" class="headerlink" title="划分子网和构建超网"></a>划分子网和构建超网</h4><ul>
<li><p>两级IP到三级IP</p>
<ul>
<li><p>两级IP（&lt;网络号&gt;，&lt;主机号&gt;）的缺陷：</p>
</li>
<li><p>IP地址的空间利用率有时很低</p>
<ul>
<li>两级IP地址不够灵活</li>
</ul>
</li>
<li><p>给每一个物理网络分配一个网络号会使路由表变得太大而使网络性能变坏。</p>
</li>
<li><p>三级IP地址：将其中二级IP的主机号取出并高x位变成子网络，形成网络号+子网号+主机号的地址格式</p>
</li>
<li><p>划分子网：划分子网属于一个单位内部的事情，它将二级IP地址变为三级IP地址</p>
</li>
</ul>
</li>
</ul>
<h4 id="无分类编制CIDR"><a href="#无分类编制CIDR" class="headerlink" title="无分类编制CIDR"></a>无分类编制CIDR</h4><ul>
<li>CIDR取消了传统的A类、B类和C类地址以及划分子网的概念，并且用网络前缀代替网络号和子网号，后面的部分指明主机。因此，CIDR使IP地址从三级地址(使用子网掩码)，又回到了两级地址（无分类的两级编址）。</li>
<li><p>CIDR把网络前缀相同的连续的IP地址组成一个”CIDR地址块”只要知道CIDR地址块中的任何一个地址，就可以知道这地址块的起始地址(即最小地址)和最大地址，以及地址块中的地址数。具体看如下例子</p>
</li>
<li><p>地址掩码：是一连串的1和0组成，而1的个数救赎网络前缀长度。在斜线记法中。斜线后面的数字就是地址掩码中1的个数。</p>
</li>
<li><p>构成超网：由于一个CIDR地址块中含有很多地址，所以在路由表中就利用CIDR地址块来查找目标网络，这种地址的聚合常称为路由聚合，也称构成超网。</p>
</li>
</ul>
<h4 id="最长前缀匹配"><a href="#最长前缀匹配" class="headerlink" title="最长前缀匹配"></a>最长前缀匹配</h4><ul>
<li><p>最长前缀匹配之前，使用CIDR时，每个项目由网络前缀和下一跳地址组成。但是在查找路由表时会得到不止一个匹配结果该怎么办呢？</p>
</li>
<li><p>此时应该选择匹配结果中，有最长网络前缀的路由。因为网络前缀越长，可分配的地址数就越少，其地址信息路由就越具体</p>
</li>
</ul>
<h4 id="网际控制报文协议ICMP"><a href="#网际控制报文协议ICMP" class="headerlink" title="网际控制报文协议ICMP"></a>网际控制报文协议ICMP</h4><ul>
<li><p>为了更有效地转发IP数据报和提高交付成功的机会，在网际层使用了ICMP，ICMP允许主机或路由器报告差错情况和提供有关异常情况的报告。ICMP是互联网的标准协议，但不是高层协议。其种类如下：</p>
<ul>
<li>ICMP差错报告报文</li>
</ul>
</li>
</ul>
<ul>
<li>ICMP询问报文</li>
</ul>
<ul>
<li>ICMP的应用在于分组网间探测PING，以用来测试两台主机之间的连通性。</li>
</ul>
<h4 id="互联网的路由选择协议"><a href="#互联网的路由选择协议" class="headerlink" title="互联网的路由选择协议"></a>互联网的路由选择协议</h4><ul>
<li><p>路由选择协议分为两大类：</p>
<ul>
<li>内部网关协议</li>
</ul>
</li>
</ul>
<ul>
<li>外部网关协议</li>
</ul>
<ul>
<li><p>内部网关协议</p>
<ul>
<li>RIP是内部网关协议中最先得到广泛应用的协议，也被称为路由信息协议，但是其很少被使用。其主要特点如下：<ul>
<li>仅和相邻路由器交换信息。</li>
<li>路由器交换的信息是当前路由器所知道的全部信息，即自己现在的路由</li>
<li>按固定的时间间隔交换路由信息，例如，每隔30秒。</li>
<li>因此，RIP有如下的优缺点。</li>
<li>当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。</li>
<li>RIP 协议最大的优点就是实现简单，开销较小。</li>
<li>RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。</li>
<li>路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。</li>
</ul>
</li>
</ul>
</li>
<li><p>OSPF最主要的特征就是使用分布式的链路状态协议，其主要特点：</p>
<ul>
<li>使用洪泛法向本自治系统中所有路由器发送信息。</li>
</ul>
</li>
</ul>
<ul>
<li><p>发送的信息是与本路由器相邻的所有路由器的链路状态。</p>
</li>
<li><p>只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息。</p>
</li>
</ul>
<h4 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h4><ul>
<li>解决IP地址耗尽的根本措施在于采用具有更大地址空间的新版本IP，即IPv6。它有两大部分组成：基本首部，有效载荷</li>
<li>IPv6采用的是点分十六进制的记法，把每个十六位的值用十六进制表示，并且各个值之间用冒号分割</li>
<li>冒号十六进制允许零压缩，但只能使用一次零压缩</li>
<li>冒号十六进制可以结合使用点分十进制记法的后缀。</li>
</ul>
<h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><h4 id="运输层协议概述"><a href="#运输层协议概述" class="headerlink" title="运输层协议概述"></a>运输层协议概述</h4><ul>
<li>运输层功能<ul>
<li>运输层应用进程之间提供端到端的逻辑通信。这与网络层的区别在于网络层是为主机之间提供逻辑通信的</li>
<li>运输层需要对收到的报文进行差错检验</li>
<li>运输层有两种不同的运输协议，即面向连接的TCP和无连接的UDP</li>
</ul>
</li>
<li>TCP/IP的运输层有两个不同的协议：<ul>
<li>用户数据报协议UDP</li>
<li>传输控制协议TCP</li>
</ul>
</li>
<li>UDP协议特点<ul>
<li>提供无连接服务</li>
<li>尽最大努力交付</li>
<li>面向报文，UDP 一次交付一个完整的报文</li>
<li>没有拥塞控制，网络拥塞不会使源主机的发送速率降低</li>
<li>支持一对一、一对多、多对一和多对多的交互通信</li>
<li>首部开销小，只有 8 个字节</li>
<li>应用：对可靠性要求不高，需要传送的数据不多，使用频率不高。并且可以实时应用。</li>
</ul>
</li>
<li>TCP协议特点<ul>
<li>提供面向连接的服务</li>
<li>可靠传输：主要以字节为单位的滑动窗口和超时重传时间的选择</li>
<li>面向字节流</li>
<li>拥塞控制：避免由于对网络中某资源的需求超过可用资源，令网络的性能变坏</li>
<li>TCP 的流量控制：让发送方的发送速率不要太快</li>
<li>总结：TCP和UDP协议的区别</li>
</ul>
</li>
<li>TCP的特点<ul>
<li>面向连接协议</li>
<li>提供交互保证</li>
<li>较UDP实时性低</li>
<li>TCP首部开销20个字节</li>
<li>TCP速度较慢</li>
<li>拥塞机制</li>
<li>TCP将数据看成一连串的字节</li>
<li>重量级协议，资源占用多</li>
<li>只有点对点连接</li>
</ul>
</li>
<li>UDP的特点<ul>
<li>无连接协议</li>
<li>尽最大努力交付，不提供有序、序列保证</li>
<li>较好的实时性</li>
<li>首部开销8字节</li>
<li>运行速度较快</li>
<li>无拥塞机制</li>
<li>面向报文</li>
<li>轻量级</li>
<li>一对一，一对多，多对多</li>
</ul>
</li>
<li>运输层的端口<ul>
<li>运行在计算机中的进程是用进程标识符来标志的。但运行在应用层的各种应用进程却不应当让计算机操作系统指派它的进程标识符。这是因为在互联网上使用的计算机的操作系统种类很多，而不同的操作系统又使用不同格式的进程标识符。<br>为了使运行不同操作系统的计算机的应用进程能够互相通信，就必须用统一的方法对 TCP/IP 体系的应用进程进行标志。</li>
<li>由于进程的创建和撤销都是动态的，发送方几乎无法识别其他机器上的进程。有时我们会改换接收报文的进程，但并不需要通知所有发送方。所以我们往往需要利用目的主机提供的功能来识别终点，而不需要知道实现这个功能的进程。</li>
<li>解决这个问题的方法就是在运输层使用协议端口号 (protocol port number)，或通常简称为端口(port)。虽然通信的终点是应用进程，但我们可以把端口想象是通信的终点，因为我们只要把要传送的报文交到目的主机的某一个合适的目的端口，剩下的工作（即最后交付目的进程）就由 TCP来完成。</li>
</ul>
</li>
</ul>
<h4 id="TCP可靠传输的实现"><a href="#TCP可靠传输的实现" class="headerlink" title="TCP可靠传输的实现"></a>TCP可靠传输的实现</h4><ul>
<li><p>以字节单位的滑动窗口</p>
<ul>
<li><p>TCP使用流水线传输和滑动窗口协议实现高效、可靠的传输。TCP 的滑动窗口是以字节为单位的。</p>
</li>
<li><p>发送方 A 和接收方 B 分别维持一个发送窗口和一个接收窗口。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>发送窗口表示：在没有收到确认的情况下，可以连续把窗口内的数据全部发送出去。</li>
</ul>
<ul>
<li>接收窗口表示：只允许接收落入窗口内的数据。</li>
</ul>
<ul>
<li><p>超时重传时间的选择</p>
<ul>
<li>重传机制是 TCP 中最重要和最复杂的问题之一。</li>
<li>TCP 每发送一个报文段，就对这个报文段设置一次计时器。</li>
<li>只要计时器设置的重传时间到但还没有收到确认，就要重传这一报文段。</li>
<li>重传时间的选择是 TCP 最复杂的问题之一。</li>
</ul>
</li>
<li><p>利用滑动窗口实现流量控制</p>
<ul>
<li>一般说来，我们总是希望数据传输得更快一些。但如果发送方把数据发送得过快，接收方就可能来不及接收，这就会造成数据的丢失。</li>
<li>流量控制 (flow control) 就是让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞。</li>
<li>利用滑动窗口机制可以很方便地在 TCP 连接上实现流量控制。</li>
</ul>
</li>
<li><p>拥塞机制</p>
<ul>
<li>在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种现象称为拥塞 (congestion)。</li>
<li>最坏结果：系统崩溃。</li>
</ul>
</li>
<li><p>网络拥塞往往是由许多因素引起的。例如：</p>
<ul>
<li>点缓存的容量太小；</li>
<li>链路的容量不足；</li>
<li>处理机处理的速率太慢；</li>
<li>拥塞本身会进一步加剧拥塞；</li>
<li>总的来说，出现拥塞的原因在于对资源的需求大于可用资源</li>
</ul>
</li>
<li><p>TCP的拥塞控制方法</p>
<ul>
<li><p>慢开始与拥塞窗口</p>
<ul>
<li>TCP 采用基于窗口的方法进行拥塞控制。该方法属于闭环控制方法。</li>
<li>TCP发送方维持一个拥塞窗口 cwnd</li>
<li><p>发送端利用拥塞窗口根据网络的拥塞情况调整发送的数据量。</p>
</li>
<li><p>发送窗口大小不仅取决于接收方窗口，还取决于网络的拥塞状况</p>
</li>
<li>只要网络没有出现拥塞，拥塞窗口就可以再增大一些，以便把更多的分组发送出去，这样就可以提高网络的利用率。</li>
<li>但只要网络出现拥塞或有可能出现拥塞，就必须把拥塞窗口减小一些，以减少注入到网络中的分组数，以便缓解网络出现的拥塞。</li>
<li>其中，对于拥塞的判断，有以下两个指标：1.重传定时器超时。2.收到三个重复的ACK。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="应用层协议"><a href="#应用层协议" class="headerlink" title="应用层协议"></a>应用层协议</h3><ul>
<li>应用层协议主要定义运行在不同端系统上的应用程序进程之间如何相互传递信息</li>
<li><p>常用的几种协议：DNS、FTP、HTTP、DHCP 的作用</p>
<ul>
<li>DNS：域名系统DNS是互联网使用的命名系统，用来把便于人们使用的机器名字转换为IP地址。DNS同时占用TCP协议与UDP协议的53号端口。</li>
<li>FTP：文件传送协议FTP是互联网上使用的最广泛的文件传送协议。FTP使用的传输层协议是</li>
<li>TCP，FTP 传数据流占用20号端口，FTP传控制流占用21号端口。</li>
<li>HTTP：HTTP协议定义了浏览器怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。HTTP使用传输层协议为TCP，端口号为80。</li>
<li>DHCP：互联网目前广泛使用的动态主机配置协议DHCP，它提供一种机制，成为即插即用联网。DHCP使用UDP，端口号为67和68。</li>
</ul>
</li>
<li><p>在应用层，用到DNS协议，作用是域名解析，HTTP协议浏览器和服务器之间的交互访问协议。</p>
</li>
<li>在传输层，运用UDP域名解析协议使用的运输层协议，TCP浏览器和WWW服务器之间建立连接，提供可靠的数据传输。</li>
<li>在网际层IP，IP数据报传输和路由选择，ICMP提供网络传输中的差错检测，ARP将本机缺省的网关IP地址映射成物理地址（MAC地址）</li>
</ul>

  
  
    
    <div class='footer'>
      
        <div class='references'>
          <section class='header'>
            
              <i class="fas fa-quote-left fa-fw" aria-hidden="true"></i>
            
            <span>参考资料（References）：</span>
          </section>
          <section class='body'>
            <ul>
              
                <li>
                  <a href="http://www.cskaoyan.com/forum.php" rel="external nofollow noopener noreferrer" target="_blank">
                  王道
                  </a>
                </li>
              
            </ul>
          </section>
        </div>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>This work is licensed under a <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>

              
            
              
                <p>本文永久地址：<a href=http://blog.zhuangzhihao.top/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/>http://blog.zhuangzhihao.top/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          

        
      
        
          
<div class='new-meta-item author'>
  <a class='author' href="/about" rel="nofollow">
    <img no-lazy src="https://cn.bing.com/th?id=AMMS_fc8f99fd41ebd737a71c4e13806db9a0&w=110&h=110&c=7&rs=1&qlt=80&pcl=f9f9f9&cdv=1&dpr=2&pid=16.1">
    <p>Bezhuang</p>
  </a>
</div>

        
      
        
          

        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/Accenture-Coding-Virtual-Experience/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>Accenture Coding Virtual Experience Program</p>
          <p class='content'>
The Accenture Know-the-Code Virtual Experience Program covers the fundamentals of software devel...</p>
        </a>
      
      
        <a class='next' href='/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/'>
          <p class='title'>操作系统<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>
 操作系统（OS）是管理和控制计算机硬件与软件资源，是计算机上直接运行的最基本的系统软件，任何其他软件都必须在操作系统的支持下才能运行。操作系统是用户和计算机的接口，同时也是计算机硬件和其他软...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal shadow" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>





  <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.0/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">一、计算机网络体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">计算机网络的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text">计算机网络的组成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-text">计算机网络性能指标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">计算机网络体系结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ISO-OSI-%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B"><span class="toc-text">ISO&#x2F;OSI 参考模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP-IP-%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B"><span class="toc-text">TCP&#x2F;IP 参考模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%89%A9%E7%90%86%E5%B1%82"><span class="toc-text">二、物理层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E5%B1%82%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">物理层基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80"><span class="toc-text">数据通信基础</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%88%E6%B0%8F%E5%87%86%E5%88%99%E5%92%8C%E9%A6%99%E5%86%9C%E5%AE%9A%E7%90%86"><span class="toc-text">奈氏准则和香农定理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E4%B8%8E%E8%B0%83%E5%88%B6"><span class="toc-text">编码与调制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2%E6%96%B9%E5%BC%8F"><span class="toc-text">数据交换方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E4%BB%8B%E8%B4%A8%E5%92%8C%E7%89%A9%E7%90%86%E5%B1%82%E8%AE%BE%E5%A4%87"><span class="toc-text">传输介质和物理层设备</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82"><span class="toc-text">三、数据链路层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">数据链路层的功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E5%B8%A7%EF%BC%88%E5%B0%81%E8%A3%85%E6%88%90%E5%B8%A7%EF%BC%89%E5%92%8C%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93"><span class="toc-text">组帧（封装成帧）和透明传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6%EF%BC%88%E6%A3%80%E9%94%99%E7%BC%96%E7%A0%81%EF%BC%89"><span class="toc-text">差错控制（检错编码）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E6%9C%BA%E5%88%B6"><span class="toc-text">流量控制与可靠传输机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E8%B4%A8%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">介质访问控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91"><span class="toc-text">局域网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E8%AE%BE%E5%A4%87"><span class="toc-text">数据链路层设备</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-text">网络层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1"><span class="toc-text">网络层提供的两种服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AEIP"><span class="toc-text">网际协议IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%92%E8%81%94%E7%BD%91%E7%BB%9C"><span class="toc-text">互联网络</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%9C%B0%E5%9D%80"><span class="toc-text">IP地址与硬件地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AEARP"><span class="toc-text">地址解析协议ARP</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP%E6%95%B0%E6%8D%AE%E6%8A%A5"><span class="toc-text">IP数据报</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E5%92%8C%E6%9E%84%E5%BB%BA%E8%B6%85%E7%BD%91"><span class="toc-text">划分子网和构建超网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%88%B6CIDR"><span class="toc-text">无分类编制CIDR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E9%95%BF%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D"><span class="toc-text">最长前缀匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AEICMP"><span class="toc-text">网际控制报文协议ICMP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%92%E8%81%94%E7%BD%91%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="toc-text">互联网的路由选择协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IPv6"><span class="toc-text">IPv6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-text">传输层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0"><span class="toc-text">运输层协议概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">TCP可靠传输的实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-text">应用层协议</span></a></li></ol>
    </div>
  </section>


  


</aside>



		  
		  <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="计算机网络";
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  // header 这里无论是否开启pjax都需要
  var l_header=document.getElementById("l_header");
  
  l_header.classList.add("show");
  
  
    // cover
    var cover_wrapper=document.querySelector('.cover-wrapper');
    
    cover_wrapper.id="none";
    cover_wrapper.style.display="none";
    
  
</script>

        </div>
        
  
  <footer class="footer clearfix">
    <br><br>
    
      
        
          <div><p>Copyright © 2020 - 2022 Zhihao Zhuang. All rights reserved</p>
</div>
        
      
    
      
        
          <div><div id="lc-uv"> 本站访客数：<span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 人，</div> <div id="lc-sv"> 总访问量：<span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次 </div></div>
        
      
    
  </footer>


        <a id="s-top" class="fas fa-arrow-up fa-fw" href="javascript:void(0)"></a>
      </div>
    </div>
    <div>
      <script>
/************这个文件存放不需要重载的全局变量和全局函数*********/
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/******************** Pjax ********************************/
function VPjax(){
	this.list=[] // 存放回调函数
	this.start=()=>{
	  for(var i=0;i<this.list.length;i++){
		this.list[i].run();
	  }
	}
	this.push=(fn,name)=>{
		var f=new PjaxItem(fn,name);
		this.list.push(f);
	}
	// 构造一个可以run的对象
	function PjaxItem(fn,name){
		// 函数名称
		this.name = name || fn.name
		// run方法
		this.run=()=>{
			fn()
		}
	}
}
volantis.pjax={}
volantis.pjax.method={
	complete: new VPjax(),
	error: new VPjax(),
	send: new VPjax()
}
volantis.pjax={
	...volantis.pjax,
	push: volantis.pjax.method.complete.push,
	error: volantis.pjax.method.error.push,
	send: volantis.pjax.method.send.push
}
/********************脚本懒加载函数********************************/
// 已经加入了setTimeout
function loadScript(src, cb) {
	setTimeout(function() {
		var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
		var script = document.createElement('script');
		script.setAttribute('type','text/javascript');
		if (cb) script.onload = cb;
		script.setAttribute('src', src);
		HEAD.appendChild(script);
	});
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
  };
  $(function () {
    SCload_fancybox();
  });
  function Pjax_SCload_fancybox(){
	if (typeof $.fancybox == "undefined") {
	 SCload_fancybox();
    } else {
	 pjax_fancybox();
    }
  }
  volantis.pjax.push(Pjax_SCload_fancybox)
  volantis.pjax.send(()=>{
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
  },'fancybox')
</script>


<!-- internal -->



  
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick="document.execCommand('copy')"><i class='fa fa-copy fa-fw'></i>复制文本</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>复制链接</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>在新标签页打开</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>复制图片地址</a>
        <hr id='hr-src'>
      </li>
      
        <li class='navigation'>
          <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
        </li>
      
      <hr>
      
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=https://blog.zhuangzhihao.top
        
        
        
        
          id="https:blogzhuangzhihaotop"
        >
        <i class='fa fa-fan fa-spin fa-fw'></i> 返回主页
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=https://github.com/Bezhuang/Bezhuang-blog-code
        
        
        
        
          id="https:githubcomBezhuangBezhuang-blog-code"
        >
        <i class='fa fa-code-branch fa-fw'></i> 本站源码
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' 
        
        
        
          onclick="document.execCommand('print')"
        
        >
        <i class='fa fa-print fa-fw'></i> 打印页面
      </a>
    </li>
  
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          if ('true' == 'true') {
            copyText.style.display = 'block';
            hrText.style.display = 'block';
          }
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }
      // 有音乐播放器 see: layout/_third-party/aplayer/script.ejs
      
      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>




<script>
  function loadIssuesJS() {
    if ($(".md").find(".issues-api").length == 0) return;
	
	  loadScript('/js/issues.js');
	
  };
  $(function () {
    loadIssuesJS();
  });
  volantis.pjax.push(()=>{
	if (typeof IssuesAPI == "undefined") {
	  loadIssuesJS();
	}
  },"IssuesJS")
</script>







  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
	volantis.pjax.push(pjax_initCopyCode)
</script>








  
  
<script src="/js/valine.js"></script>


<script>
  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;
    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧~";
    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }
    var valine = new Valine();
    valine.init(Object.assign({"path":null,"placeholder":"快来评论吧~","appId":"SK7sx66NNd5Bw3O3jvF2MVXq-MdYXbMMI","appKey":"j5I5paEqIfWfOlCg13vU2vNq","meta":["nick","mail","link"],"requiredFields":["nick","mail"],"enableQQ":true,"recordIP":true,"avatar":"robohash","pageSize":10,"lang":"zh-cn","highlight":true,"mathJax":true}, {
      el: '#valine_container',
      path: path,
      placeholder: pagePlaceholder,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps,
    }))
  }
  $(function () {
    pjax_valine();
  });
  volantis.pjax.push(pjax_valine);
</script>






  
<script src="/js/app.js"></script>



<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('/js/search/hexo.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
		document.addEventListener("pjax:success", listenSearch);
	
}
</script>











  <script defer>

  const LCCounter = {
    app_id: 'SK7sx66NNd5Bw3O3jvF2MVXq-MdYXbMMI',
    app_key: 'j5I5paEqIfWfOlCg13vU2vNq',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'http://blog.zhuangzhihao.top' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'http://blog.zhuangzhihao.top' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'http://blog.zhuangzhihao.top' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>




  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
    localStorage.setItem(k, v);
};

const removeLS = (k) => {
    localStorage.removeItem(k);
};

const getLS = (k) => {
    return localStorage.getItem(k);
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
var btn=$("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn");
function bindToggleButton() {
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
volantis.pjax.push(bindToggleButton);
volantis.pjax.send(()=>{
	btn.unbind('click');
},'toggle-mode-btn-unbind');
</script>







<script src="//code.tidio.co/tu8j8vmfuovtkhsj4lgr7sub986gd1ku.js" async></script>


<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->

 
	   
	    


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = ["/artitalk/"];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）

      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
		// 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
		volantis.pjax.method.complete.start();
      } catch (e) {
        console.log(e);
      }
    });

    document.addEventListener('pjax:error', function (e) {
	  // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.error.start();
      window.location.href = e.triggerElement.href;
    });
</script>
 
	  
    </div>
  </body>
</html>
