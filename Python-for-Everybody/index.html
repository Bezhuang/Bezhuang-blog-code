<!DOCTYPE html>
<html lang="zh-CN,en,default">
  <head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="preload" href="/css/first.css" as="style">
  

  <!-- 页面元数据 -->
  
  <title>Python for everybody - Bezhuang&#39;s Blog</title>
  

  
    <meta name="description" content="
The Python for Everybody Specialization provided by UNIVERSITY OF MICHIGAN introduces fundamental programming concepts including data structures, networked ...">
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Bezhuang's Blog" type="application/atom+xml">
  

  <!-- import meta -->
  

  <!-- link -->
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>

  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        '<h1><b>抱歉，您的浏览器无法访问本站</b></h1>'+
        '<h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>'+
        '继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/>'+
        '<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a>'+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
	</style>
    <div class="kill-noscript">
        <h1><b>抱歉，您的浏览器无法访问本站</b></h1>
        <h3>本页面需要浏览器支持（启用）JavaScript</h3><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a>
    </div>
</noscript>

</head>

  <body>
    

<header id="l_header" class="l_header always shadow blur show"  >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
            Bezhuang's Blog
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于我
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/projects
                  
                  
                  
                    id="projects"
                  >
                  <i class='far fa-hdd fa-fw'></i>开源库
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>暗黑模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于我
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" 
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/projects
                  
                  
                  
                    id="projects"
                  >
                  <i class='far fa-hdd fa-fw'></i>开源库
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>暗黑模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
    
        <div id="full" class='cover-wrapper post search' style="display: none;">
          
            <div class='cover-bg' style='background-image:url(/img/c言语入门.png)'></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">庄之皓 · Bezhuang</p>
    
    
      <p class="subtitle">欢迎访问我的博客！Welcome to my blog!</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="search here..." />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

      <div id="safearea">
        <div class="body-wrapper" id="pjax-container">
          

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        Python for everybody
      </h1>
      <div class='new-meta-box'>
        
          
            
  <div class='new-meta-item category'>
    <a class='notlink'>
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <a class="category-link" href="/categories/Python/">Python</a>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>本文发布于：2020年5月14日</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item wordcount">
    <a class='notlink'>
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：5.3k字</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class='notlink'>
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：33分钟</p>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  
  <blockquote>
<p>The Python for Everybody Specialization provided by UNIVERSITY OF MICHIGAN introduces fundamental programming concepts including data structures, networked application program interfaces, and databases, using the Python programming language. Python for Everybody is a completely open-source course, you can find all the notes and textbooks on its official <a target="_blank" rel="noopener" href="https://www.py4e.com/">website</a>, so this note will only contain my solution to all post-lesson exercises in this course.</p>
</blockquote>
<span id="more"></span>


	<div class="row">
    <embed src="/pdf/Coursera-py4e.pdf" width="100%" height="550" type="application/pdf">
	</div>



<h3 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h3><h4 id="Question-1"><a href="#Question-1" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program that uses a <strong>print</strong> statement to say ‘hello world’ as shown in ‘Desired Output’.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter 2"></a>Chapter 2</h3><h4 id="Question-1-1"><a href="#Question-1-1" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program to prompt the user for hours and rate per hour using input to compute gross pay. Use 35 hours and a rate of 2.75 per hour to test the program (the pay should be 96.25). You should use <strong>input</strong> to read a string and <strong>float()</strong> to convert the string to a number. Do not worry about error checking or bad user data.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pay: 96.25</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hrs = input(&quot;Enter Hours: &quot;)</span><br><span class="line">rat = input(&quot;Enter Rates: &quot;)</span><br><span class="line">pay = float(hrs) * float(rat)</span><br><span class="line">print(&quot;Pay: &quot; + str(pay))</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-3"><a href="#Chapter-3" class="headerlink" title="Chapter 3"></a>Chapter 3</h3><h4 id="Question-1-2"><a href="#Question-1-2" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program to prompt the user for hours and rate per hour using input to compute gross pay. Pay the hourly rate for the hours up to 40 and 1.5 times the hourly rate for all hours worked above 40 hours. Use 45 hours and a rate of 10.50 per hour to test the program (the pay should be 498.75). You should use <strong>input</strong> to read a string and <strong>float()</strong> to convert the string to a number. Do not worry about error checking the user input - assume the user types numbers properly.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">498.75</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hrs = input(&quot;Enter Hours:&quot;)</span><br><span class="line">h = float(hrs)</span><br><span class="line">rat = input(&quot;Enter Rates:&quot;)</span><br><span class="line">r = float(rat)</span><br><span class="line">if h &lt;=40:</span><br><span class="line">    pay = h * r</span><br><span class="line">else:</span><br><span class="line">    pay = 40 * r + (h - 40) * r * 1.5</span><br><span class="line">print(str(pay))</span><br></pre></td></tr></table></figure>
<h4 id="Question-2"><a href="#Question-2" class="headerlink" title="Question 2"></a>Question 2</h4><p>Write a program to prompt for a score between 0.0 and 1.0. If the score is out of range, print an error. If the score is between 0.0 and 1.0, print a grade using the following table:<br>Score Grade<br>>= 0.9 A<br>>= 0.8 B<br>>= 0.7 C<br>>= 0.6 D<br>&lt; 0.6 F<br>If the user enters a value out of range, print a suitable error message and exit. For the test, enter a score of 0.85.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">score = input(&quot;Enter Score: &quot;)</span><br><span class="line">sco = float(score)</span><br><span class="line">if 0.0 &lt;= sco &lt;= 1.0:</span><br><span class="line">    if sco &gt;= 0.9:</span><br><span class="line">        grade = &quot;A&quot;</span><br><span class="line">    elif sco &gt;= 0.8:</span><br><span class="line">        grade = &quot;B&quot;</span><br><span class="line">    elif sco &gt;= 0.7:</span><br><span class="line">        grade = &quot;C&quot;</span><br><span class="line">    elif sco &gt;= 0.6:</span><br><span class="line">        grade = &quot;D&quot;</span><br><span class="line">    else:</span><br><span class="line">        grade = &quot;F&quot;</span><br><span class="line">    print(grade)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;error&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-4"><a href="#Chapter-4" class="headerlink" title="Chapter 4"></a>Chapter 4</h3><h4 id="Question-1-3"><a href="#Question-1-3" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program to prompt the user for hours and rate per hour using input to compute gross pay. Pay should be the normal rate for hours up to 40 and time-and-a-half for the hourly rate for all hours worked above 40 hours. Put the logic to do the computation of pay in a function called <strong>computepay()</strong> and use the function to do the computation. The function should return a value. Use 45 hours and a rate of 10.50 per hour to test the program (the pay should be 498.75). You should use <strong>input</strong> to read a string and <strong>float()</strong> to convert the string to a number. Do not worry about error checking the user input unless you want to - you can assume the user types numbers properly. Do not name your variable sum or use the sum() function.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pay 498.75</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def computepay(h,r):</span><br><span class="line">    if h &lt;= 40:</span><br><span class="line">        p = h * r</span><br><span class="line">    else:</span><br><span class="line">        p = 40 * r + (h - 40) * 1.5 * r</span><br><span class="line">    return p</span><br><span class="line">hrs = input(&quot;Enter Hours:&quot;)</span><br><span class="line">ho = float(hrs)</span><br><span class="line">rat = input(&quot;Enter Rates:&quot;)</span><br><span class="line">ro = float(rat)</span><br><span class="line">p = computepay(ho,ro)</span><br><span class="line">print(&quot;Pay&quot;,p)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-5"><a href="#Chapter-5" class="headerlink" title="Chapter 5"></a>Chapter 5</h3><h4 id="Question-1-4"><a href="#Question-1-4" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program that repeatedly prompts a user for integer numbers until the user enters ‘done’. Once ‘done’ is entered, print out the largest and smallest of the numbers. If the user enters anything other than a valid number catch it with a try/except and put out an appropriate message and ignore the number. Enter 7, 2, bob, 10, and 4 and match the output below.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Invalid input</span><br><span class="line">Maximum is 10</span><br><span class="line">Minimum is 2</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">largest = None</span><br><span class="line">smallest = None</span><br><span class="line">shuzi = []</span><br><span class="line">while True:</span><br><span class="line">    num = input(&quot;Enter a number: &quot;)</span><br><span class="line">    if num == &quot;done&quot; : break</span><br><span class="line">    else:</span><br><span class="line">        try:</span><br><span class="line">            numm = int(num)</span><br><span class="line">            shuzi.append(numm)</span><br><span class="line">        except:</span><br><span class="line">            print(&quot;Invalid input&quot;)</span><br><span class="line">            continue</span><br><span class="line">largest = max(shuzi)</span><br><span class="line">smallest = min(shuzi)</span><br><span class="line">print(&quot;Maximum is&quot;, largest)</span><br><span class="line">print(&quot;Minimum is&quot;, smallest)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-6"><a href="#Chapter-6" class="headerlink" title="Chapter 6"></a>Chapter 6</h3><h4 id="Question-1-5"><a href="#Question-1-5" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write code using find() and string slicing (see section 6.10) to extract the number at the end of the line below. Convert the extracted value to a floating point number and print it out.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.8475</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text = &quot;X-DSPAM-Confidence:    0.8475&quot;;</span><br><span class="line">shuziqian = text.find(&#x27;:&#x27;)</span><br><span class="line">number = float(text[shuziqian+1:])</span><br><span class="line">print(number)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-7"><a href="#Chapter-7" class="headerlink" title="Chapter 7"></a>Chapter 7</h3><h4 id="Question-1-6"><a href="#Question-1-6" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program that prompts for a file name, then opens that file and reads through the file, looking for lines of the form:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-DSPAM-Confidence:    0.8475</span><br></pre></td></tr></table></figure>
<p>Count these lines and extract the floating point values from each of the lines and compute the average of those values and produce an output as shown below. Do not use the sum() function or a variable named sum in your solution.<br>You can download the sample data at <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/mbox-short.txt">http://www.py4e.com/code3/mbox-short.txt</a> when you are testing below enter <strong>mbox-short.txt</strong> as the file name.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Average spam confidence: 0.750718518519</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Use the file name mbox-short.txt as the file name</span><br><span class="line">fname = input(&quot;Enter file name: &quot;)</span><br><span class="line">fh = open(fname)</span><br><span class="line">value = 0</span><br><span class="line">count = 0</span><br><span class="line">for line in fh:</span><br><span class="line">    if not line.startswith(&quot;X-DSPAM-Confidence:&quot;) :</span><br><span class="line">        continue</span><br><span class="line">    shuziqian = line.find(&#x27;:&#x27;)+1</span><br><span class="line">    value = float(line[shuziqian:]) + value</span><br><span class="line">    count = count + 1</span><br><span class="line">print(&quot;Average spam confidence:&quot;,value / count)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-8"><a href="#Chapter-8" class="headerlink" title="Chapter 8"></a>Chapter 8</h3><h4 id="Question-1-7"><a href="#Question-1-7" class="headerlink" title="Question 1"></a>Question 1</h4><p>Open the file <strong>romeo.txt</strong> and read it line by line. For each line, split the line into a list of words using the <strong>split()</strong> method. The program should build a list of words. For each word on each line check to see if the word is already in the list and if not append it to the list. When the program completes, sort and print the resulting words in alphabetical order.<br>You can download the sample data at <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/romeo.txt">http://www.py4e.com/code3/romeo.txt</a><br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;Arise&#x27;, &#x27;But&#x27;, &#x27;It&#x27;, &#x27;Juliet&#x27;, &#x27;Who&#x27;, &#x27;already&#x27;, &#x27;and&#x27;, &#x27;breaks&#x27;, &#x27;east&#x27;, &#x27;envious&#x27;, &#x27;fair&#x27;, &#x27;grief&#x27;, &#x27;is&#x27;, &#x27;kill&#x27;, &#x27;light&#x27;, &#x27;moon&#x27;, &#x27;pale&#x27;, &#x27;sick&#x27;, &#x27;soft&#x27;, &#x27;sun&#x27;, &#x27;the&#x27;, &#x27;through&#x27;, &#x27;what&#x27;, &#x27;window&#x27;, &#x27;with&#x27;, &#x27;yonder&#x27;]</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fname = input(&quot;Enter file name: &quot;)</span><br><span class="line">fh = open(fname)</span><br><span class="line">lst = list()</span><br><span class="line">for line in fh:</span><br><span class="line">    line = line.strip()</span><br><span class="line">    words = line.split()</span><br><span class="line">    for word in words:</span><br><span class="line">        if word not in lst:</span><br><span class="line">            lst.append(word)</span><br><span class="line">print(sorted(lst))</span><br></pre></td></tr></table></figure>
<h4 id="Question-2-1"><a href="#Question-2-1" class="headerlink" title="Question 2"></a>Question 2</h4><p>Open the file <strong>mbox-short.txt</strong> and read it line by line. When you find a line that starts with ‘From ‘ like the following line:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">From stephen.marquard@uct.ac.za Sat Jan  5 09:14:16 2008</span><br></pre></td></tr></table></figure>
<p>You will parse the From line using split() and print out the second word in the line (i.e. the entire address of the person who sent the message). Then print out a count at the end.<br><strong>Hint:</strong> make sure not to include the lines that start with ‘From:’.<br>You can download the sample data at <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/mbox-short.txt">http://www.py4e.com/code3/mbox-short.txt</a><br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">stephen.marquard@uct.ac.za</span><br><span class="line">louis@media.berkeley.edu</span><br><span class="line">zqian@umich.edu</span><br><span class="line">rjlowe@iupui.edu</span><br><span class="line">zqian@umich.edu</span><br><span class="line">rjlowe@iupui.edu</span><br><span class="line">cwen@iupui.edu</span><br><span class="line">cwen@iupui.edu</span><br><span class="line">gsilver@umich.edu</span><br><span class="line">gsilver@umich.edu</span><br><span class="line">zqian@umich.edu</span><br><span class="line">gsilver@umich.edu</span><br><span class="line">wagnermr@iupui.edu</span><br><span class="line">zqian@umich.edu</span><br><span class="line">antranig@caret.cam.ac.uk</span><br><span class="line">gopal.ramasammycook@gmail.com</span><br><span class="line">david.horwitz@uct.ac.za</span><br><span class="line">david.horwitz@uct.ac.za</span><br><span class="line">david.horwitz@uct.ac.za</span><br><span class="line">david.horwitz@uct.ac.za</span><br><span class="line">stephen.marquard@uct.ac.za</span><br><span class="line">louis@media.berkeley.edu</span><br><span class="line">louis@media.berkeley.edu</span><br><span class="line">ray@media.berkeley.edu</span><br><span class="line">cwen@iupui.edu</span><br><span class="line">cwen@iupui.edu</span><br><span class="line">cwen@iupui.edu</span><br><span class="line">There were 27 lines in the file with From as the first word</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fname = input(&quot;Enter file name: &quot;)</span><br><span class="line">if len(fname) &lt; 1 : fname = &quot;mbox-short.txt&quot;</span><br><span class="line">fh = open(fname)</span><br><span class="line">count = 0</span><br><span class="line">for line in fh:</span><br><span class="line">    line = line.strip()</span><br><span class="line">    if not line.startswith(&quot;From &quot;):</span><br><span class="line">        continue</span><br><span class="line">    words = line.split()</span><br><span class="line">    print(words[1])</span><br><span class="line">    count = count + 1</span><br><span class="line">print(&quot;There were&quot;, count, &quot;lines in the file with From as the first word&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-9"><a href="#Chapter-9" class="headerlink" title="Chapter 9"></a>Chapter 9</h3><h4 id="Question-1-8"><a href="#Question-1-8" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program to read through the <strong>mbox-short.txt</strong> and figure out who has sent the greatest number of mail messages. The program looks for ‘From ‘ lines and takes the second word of those lines as the person who sent the mail. The program creates a Python dictionary that maps the sender’s mail address to a count of the number of times they appear in the file. After the dictionary is produced, the program reads through the dictionary using a maximum loop to find the most prolific committer.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cwen@iupui.edu 5</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fname = input(&quot;Enter file name: &quot;)</span><br><span class="line">if len(fname) &lt; 1 : fname = &quot;mbox-short.txt&quot;</span><br><span class="line"></span><br><span class="line">fh = open(fname)</span><br><span class="line">count_dict = dict()</span><br><span class="line"></span><br><span class="line">for line in fh:</span><br><span class="line">    line = line.strip()</span><br><span class="line">    if not line.startswith(&#x27;From &#x27;):</span><br><span class="line">        continue</span><br><span class="line">    words = line.split()</span><br><span class="line">    count_dict[words[1]] = 1 + count_dict.get(words[1],0)</span><br><span class="line">sort_list = sorted([(v,k) for k,v in count_dict.items()],reverse=True)</span><br><span class="line">print(sort_list[0][1],sort_list[0][0])</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-10"><a href="#Chapter-10" class="headerlink" title="Chapter 10"></a>Chapter 10</h3><h4 id="Question-1-9"><a href="#Question-1-9" class="headerlink" title="Question 1"></a>Question 1</h4><p>Write a program to read through the <strong>mbox-short.txt</strong> and figure out the distribution by hour of the day for each of the messages. You can pull the hour out from the ‘From ‘ line by finding the time and then splitting the string a second time using a colon.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">From stephen.marquard@uct.ac.za Sat Jan  5 09:14:16 2008</span><br></pre></td></tr></table></figure>
<p>Once you have accumulated the counts for each hour, print out the counts, sorted by hour as shown below.<br><strong>Desired Output</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">04 3</span><br><span class="line">06 1</span><br><span class="line">07 1</span><br><span class="line">09 2</span><br><span class="line">10 3</span><br><span class="line">11 6</span><br><span class="line">14 1</span><br><span class="line">15 2</span><br><span class="line">16 4</span><br><span class="line">17 2</span><br><span class="line">18 1</span><br><span class="line">19 1</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fname = input(&quot;Enter file name: &quot;)</span><br><span class="line">if len(fname) &lt; 1 : fname = &quot;mbox-short.txt&quot;</span><br><span class="line">fh = open(fname)</span><br><span class="line">count_dict = dict()</span><br><span class="line">for line in fh:</span><br><span class="line">    line = line.strip()</span><br><span class="line">    if not line.startswith(&#x27;From &#x27;):</span><br><span class="line">        continue</span><br><span class="line">    words = line.split()</span><br><span class="line">    times = words[5].split(&#x27;:&#x27;)</span><br><span class="line">    hours = times[0]</span><br><span class="line">    count_dict[hours] = 1 + count_dict.get(hours,0)</span><br><span class="line">count_list = sorted([(k,v) for k,v in count_dict.items()])</span><br><span class="line">for k,v in count_list:</span><br><span class="line">    print(k,v)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-11"><a href="#Chapter-11" class="headerlink" title="Chapter 11"></a>Chapter 11</h3><h4 id="Question-1-10"><a href="#Question-1-10" class="headerlink" title="Question 1"></a>Question 1</h4><p><strong>Handling The Data</strong><br>The basic outline of this problem is to read the file, look for integers using the <strong>re.findall()</strong>, looking for a regular expression of <strong>‘[0-9]+’</strong> and then converting the extracted strings to integers and summing up the integers.<br><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">file = open(&#x27;C:/Users/dell/Desktop/regex_sum_501451.txt&#x27;, &#x27;r&#x27;)</span><br><span class="line">file_data = file.read()</span><br><span class="line">numbers_str = re.findall(&#x27;[0-9]+&#x27;, file_data)</span><br><span class="line">total = 0</span><br><span class="line">for number_str in numbers_str:</span><br><span class="line">    total = total + int(number_str)</span><br><span class="line">print(total)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-12"><a href="#Chapter-12" class="headerlink" title="Chapter 12"></a>Chapter 12</h3><h4 id="Question-1-11"><a href="#Question-1-11" class="headerlink" title="Question 1"></a>Question 1</h4><p><strong>Exploring the HyperText Transport Protocol</strong><br>You are to retrieve the following document using the HTTP protocol in a way that you can examine the HTTP Response headers.</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://data.pr4e.org/intro-short.txt">http://data.pr4e.org/intro-short.txt</a><br>There are three ways that you might retrieve this web page and look at the response headers:</li>
<li><strong>Preferred:</strong> Modify the <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/socket1.py">socket1.py</a> program to retrieve the above URL and print out the headers and data. Make sure to <strong>change</strong> the code to retrieve the above URL - the values are different for each URL.</li>
<li>Open the URL in a web browser with a developer console or FireBug and manually examine the headers that are returned.</li>
<li>Use the <strong>telnet</strong> program as shown in lecture to retrieve the headers and content.<br><strong>Desired Output</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Sun, 01 Oct 2017 05:25:59 GMT</span><br><span class="line">Server: Apache/2.4.7 (Ubuntu)</span><br><span class="line">Last-Modified: Sat, 13 May 2017 11:22:22 GMT</span><br><span class="line">ETag: “1d3-54f6609240717”</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 467</span><br><span class="line">Cache-Control: max-age=0, no-cache, no-store, must-revalidate</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Expires: Wed, 11 Jan 1984 05:00:00 GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/plain</span><br></pre></td></tr></table></figure>
<p><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">mysock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">mysock.connect((&#x27;data.pr4e.org&#x27;, 80))</span><br><span class="line">cmd = &#x27;GET http://data.pr4e.org/intro-short.txt HTTP/1.0\r\n\r\n&#x27;.encode()</span><br><span class="line">mysock.send(cmd)</span><br><span class="line">while True:</span><br><span class="line">    data = mysock.recv(512)</span><br><span class="line">    if (len(data) &lt; 1):</span><br><span class="line">        break</span><br><span class="line">    print(data.decode())</span><br><span class="line">mysock.close()</span><br></pre></td></tr></table></figure>
<h4 id="Question-2-2"><a href="#Question-2-2" class="headerlink" title="Question 2"></a>Question 2</h4><p><strong>Scraping Numbers from HTML using BeautifulSoup</strong> In this assignment you will write a Python program similar to <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/urllink2.py">http://www.py4e.com/code3/urllink2.py</a>. The program will use <strong>urllib</strong> to read the HTML from the data files below, and parse the data, extracting numbers and compute the sum of the numbers in the file.<br>We provide two files for this assignment. One is a sample file where we give you the sum for your testing and the other is the actual data you need to process for the assignment.</p>
<ul>
<li>Sample data: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/comments_42.html">http://py4e-data.dr-chuck.net/comments_42.html</a> (Sum=2553)</li>
<li>Actual data: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/comments_501453.html">http://py4e-data.dr-chuck.net/comments_501453.html</a> (Sum ends with 35)<br>You do not need to save these files to your folder since your program will read the data directly from the URL. <strong>Note:</strong> Each student will have a distinct data url for the assignment - so only use your own data url for analysis.<br><strong>Solution</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from urllib.request import urlopen</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import ssl</span><br><span class="line"># Ignore SSL certificate errors</span><br><span class="line">ctx = ssl.create_default_context()</span><br><span class="line">ctx.check_hostname = False</span><br><span class="line">ctx.verify_mode = ssl.CERT_NONE</span><br><span class="line">url = input(&#x27;Enter - &#x27;)</span><br><span class="line">html = urlopen(url, context=ctx).read()</span><br><span class="line"># html.parser is the HTML parser included in the standard Python 3 library.</span><br><span class="line"># information on other HTML parsers is here:</span><br><span class="line"># http://www.crummy.com/software/BeautifulSoup/bs4/doc/#installing-a-parser</span><br><span class="line">soup = BeautifulSoup(html, &quot;html.parser&quot;)</span><br><span class="line"># Retrieve all of the anchor tags</span><br><span class="line">tags = soup(&#x27;span&#x27;)</span><br><span class="line">total = 0</span><br><span class="line">for tag in tags:</span><br><span class="line">    # Look at the parts of a tag</span><br><span class="line">    total = total + int(tag.contents[0])</span><br><span class="line">print(total)</span><br></pre></td></tr></table></figure>
<h4 id="Question-3"><a href="#Question-3" class="headerlink" title="Question 3"></a>Question 3</h4><p><strong>Following Links in Python</strong><br>In this assignment you will write a Python program that expands on <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/urllinks.py">http://www.py4e.com/code3/urllinks.py</a>. The program will use <strong>urllib</strong> to read the HTML from the data files below, extract the href= vaues from the anchor tags, scan for a tag that is in a particular position relative to the first name in the list, follow that link and repeat the process a number of times and report the last name you find.<br>We provide two files for this assignment. One is a sample file where we give you the name for your testing and the other is the actual data you need to process for the assignment</p>
<ul>
<li>Sample problem: Start at <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/known_by_Fikret.html">http://py4e-data.dr-chuck.net/known_by_Fikret.html</a><br>Find the link at position <strong>3</strong> (the first name is 1). Follow that link. Repeat this process <strong>4</strong> times. The answer is the last name that you retrieve.<br>Sequence of names: Fikret Montgomery Mhairade Butchi Anayah<br>Last name in sequence: Anayah</li>
<li>Actual problem: Start at: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/known_by_Malaeka.html">http://py4e-data.dr-chuck.net/known_by_Malaeka.html</a><br>Find the link at position <strong>18</strong> (the first name is 1). Follow that link. Repeat this process <strong>7</strong> times. The answer is the last name that you retrieve.<br>Hint: The first character of the name of the last page that you will load is: K<br><strong>Solution</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">import urllib.error</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import ssl</span><br><span class="line">def findUrl(url, position):</span><br><span class="line">    html = urllib.request.urlopen(url, context=ctx).read()</span><br><span class="line">    soup = BeautifulSoup(html, &#x27;html.parser&#x27;)</span><br><span class="line">    # Retrieve all of the anchor tags</span><br><span class="line">    tags = soup(&#x27;a&#x27;)</span><br><span class="line">    return tags[position].get(&#x27;href&#x27;, None)</span><br><span class="line"># Ignore SSL certificate errors</span><br><span class="line">ctx = ssl.create_default_context()</span><br><span class="line">ctx.check_hostname = False</span><br><span class="line">ctx.verify_mode = ssl.CERT_NONE</span><br><span class="line">count_str = input(&#x27;Enter count - &#x27;)</span><br><span class="line">count = int(count_str)</span><br><span class="line">position_str = input(&#x27;Enter position - &#x27;)</span><br><span class="line">position = int(position_str)-1</span><br><span class="line">for i in range(count):</span><br><span class="line">    if i == 0:</span><br><span class="line">        url_now = input(&#x27;Enter - &#x27;)</span><br><span class="line">        print(url_now)</span><br><span class="line">        url_now = findUrl(url_now, position)</span><br><span class="line">        print(url_now)</span><br><span class="line">    else:</span><br><span class="line">        url_now = findUrl(url_now, position)</span><br><span class="line">        print(url_now)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-13"><a href="#Chapter-13" class="headerlink" title="Chapter 13"></a>Chapter 13</h3><h4 id="Question-1-12"><a href="#Question-1-12" class="headerlink" title="Question 1"></a>Question 1</h4><p><strong>Extracting Data from XML</strong><br>In this assignment you will write a Python program somewhat similar to <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/geoxml.py">http://www.py4e.com/code3/geoxml.py</a>. The program will prompt for a URL, read the XML data from that URL using <strong>urllib</strong> and then parse and extract the comment counts from the XML data, compute the sum of the numbers in the file.<br>We provide two files for this assignment. One is a sample file where we give you the sum for your testing and the other is the actual data you need to process for the assignment.</p>
<ul>
<li>Sample data: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/comments_42.xml">http://py4e-data.dr-chuck.net/comments_42.xml</a> (Sum=2553)</li>
<li>Actual data: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/comments_501455.xml">http://py4e-data.dr-chuck.net/comments_501455.xml</a> (Sum ends with 78)<br>You do not need to save these files to your folder since your program will read the data directly from the URL. <strong>Note:</strong> Each student will have a distinct data url for the assignment - so only use your own data url for analysis.<br><strong>Solution</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">import urllib.error</span><br><span class="line">import xml.etree.ElementTree as ET</span><br><span class="line">url = &#x27;http://py4e-data.dr-chuck.net/comments_501455.xml&#x27;</span><br><span class="line">print(&#x27;Retrieving&#x27;, url)</span><br><span class="line">uh = urllib.request.urlopen(url)</span><br><span class="line">data = uh.read()</span><br><span class="line">print(&#x27;Retrieved&#x27;, len(data), &#x27;characters&#x27;)</span><br><span class="line">tree = ET.fromstring(data)</span><br><span class="line">comments_node = tree.findall(&#x27;comments&#x27;)</span><br><span class="line">comment_node = comments_node[0].findall(&#x27;comment&#x27;)</span><br><span class="line">total = 0</span><br><span class="line">for node in comment_node:</span><br><span class="line">    total = total + int(node.find(&#x27;count&#x27;).text)</span><br><span class="line">print(total)</span><br></pre></td></tr></table></figure>
<h4 id="Question-2-3"><a href="#Question-2-3" class="headerlink" title="Question 2"></a>Question 2</h4><p><strong>Extracting Data from JSON</strong><br>In this assignment you will write a Python program somewhat similar to <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/json2.py">http://www.py4e.com/code3/json2.py</a>. The program will prompt for a URL, read the JSON data from that URL using <strong>urllib</strong> and then parse and extract the comment counts from the JSON data, compute the sum of the numbers in the file and enter the sum below:<br>We provide two files for this assignment. One is a sample file where we give you the sum for your testing and the other is the actual data you need to process for the assignment.</p>
<ul>
<li>Sample data: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/comments_42.json">http://py4e-data.dr-chuck.net/comments_42.json</a> (Sum=2553)</li>
<li>Actual data: <a target="_blank" rel="noopener" href="http://py4e-data.dr-chuck.net/comments_501456.json">http://py4e-data.dr-chuck.net/comments_501456.json</a> (Sum ends with 42)<br>You do not need to save these files to your folder since your program will read the data directly from the URL. <strong>Note:</strong> Each student will have a distinct data url for the assignment - so only use your own data url for analysis.<br><strong>Solution</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">import urllib.error</span><br><span class="line">import json</span><br><span class="line">url = &#x27;http://py4e-data.dr-chuck.net/comments_501456.json&#x27;</span><br><span class="line">print(&#x27;Retrieving&#x27;, url)</span><br><span class="line">uh = urllib.request.urlopen(url)</span><br><span class="line">data = uh.read()</span><br><span class="line">info = json.loads(data.decode())</span><br><span class="line">print(&#x27;User count:&#x27;, len(info))</span><br><span class="line">comments_dic = info[&#x27;comments&#x27;]</span><br><span class="line">total = 0</span><br><span class="line">for item in comments_dic:</span><br><span class="line">    total = total + int(item[&#x27;count&#x27;])</span><br><span class="line">print(total)</span><br></pre></td></tr></table></figure>
<h4 id="Question-3-1"><a href="#Question-3-1" class="headerlink" title="Question 3"></a>Question 3</h4><p><strong>Calling a JSON API</strong><br>In this assignment you will write a Python program somewhat similar to <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/geojson.py">http://www.py4e.com/code3/geojson.py</a>. The program will prompt for a location, contact a web service and retrieve JSON for the web service and parse that data, and retrieve the first <strong>place_id</strong> from the JSON. A place ID is a textual identifier that uniquely identifies a place as within Google Maps.<br><strong>API End Points</strong><br>To complete this assignment, you should use this API endpoint that has a static subset of the Google Data:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://py4e-data.dr-chuck.net/json?</span><br></pre></td></tr></table></figure>
<p>This API uses the same parameter (address) as the Google API. This API also has no rate limit so you can test as often as you like. If you visit the URL with no parameters, you get “No address…” response.<br>To call the API, you need to include a <strong>key=</strong> parameter and provide the address that you are requesting as the <strong>address=</strong> parameter that is properly URL encoded using the <strong>urllib.parse.urlencode()</strong> function as shown in <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/geojson.py">http://www.py4e.com/code3/geojson.py</a><br>Make sure to check that your code is using the API endpoint is as shown above. You will get <em>different</em> results from the <strong>geojson</strong> and <strong>json</strong> endpoints so make sure you are using the same end point as this autograder is using.<br><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">import urllib.error</span><br><span class="line">import json</span><br><span class="line">import ssl</span><br><span class="line">api_key = False</span><br><span class="line"># If you have a Google Places API key, enter it here</span><br><span class="line"># api_key = &#x27;AIzaSy___IDByT70&#x27;</span><br><span class="line"># https://developers.google.com/maps/documentation/geocoding/intro</span><br><span class="line">if api_key is False:</span><br><span class="line">    api_key = 42</span><br><span class="line">    serviceurl = &#x27;http://py4e-data.dr-chuck.net/json?&#x27;</span><br><span class="line">else:</span><br><span class="line">    serviceurl = &#x27;https://maps.googleapis.com/maps/api/geocode/json?&#x27;</span><br><span class="line"># Ignore SSL certificate errors</span><br><span class="line">ctx = ssl.create_default_context()</span><br><span class="line">ctx.check_hostname = False</span><br><span class="line">ctx.verify_mode = ssl.CERT_NONE</span><br><span class="line">while True:</span><br><span class="line">    address = input(&#x27;Enter location: &#x27;)</span><br><span class="line">    if len(address) &lt; 1:</span><br><span class="line">        break</span><br><span class="line">    parms = dict()</span><br><span class="line">    parms[&#x27;address&#x27;] = address</span><br><span class="line">    if api_key is not False:</span><br><span class="line">        parms[&#x27;key&#x27;] = api_key</span><br><span class="line">    url = serviceurl + urllib.parse.urlencode(parms)</span><br><span class="line">    print(&#x27;Retrieving&#x27;, url)</span><br><span class="line">    uh = urllib.request.urlopen(url, context=ctx)</span><br><span class="line">    data = uh.read().decode()</span><br><span class="line">    print(&#x27;Retrieved&#x27;, len(data), &#x27;characters&#x27;)</span><br><span class="line">    try:</span><br><span class="line">        js = json.loads(data)</span><br><span class="line">    except:</span><br><span class="line">        js = None</span><br><span class="line">    if not js or &#x27;status&#x27; not in js or js[&#x27;status&#x27;] != &#x27;OK&#x27;:</span><br><span class="line">        print(&#x27;==== Failure To Retrieve ====&#x27;)</span><br><span class="line">        print(data)</span><br><span class="line">        continue</span><br><span class="line">    print(json.dumps(js, indent=4))</span><br><span class="line">    lat = js[&#x27;results&#x27;][0][&#x27;geometry&#x27;][&#x27;location&#x27;][&#x27;lat&#x27;]</span><br><span class="line">    lng = js[&#x27;results&#x27;][0][&#x27;geometry&#x27;][&#x27;location&#x27;][&#x27;lng&#x27;]</span><br><span class="line">    print(&#x27;lat&#x27;, lat, &#x27;lng&#x27;, lng)</span><br><span class="line">    location = js[&#x27;results&#x27;][0][&#x27;formatted_address&#x27;]</span><br><span class="line">    print(location)</span><br></pre></td></tr></table></figure>
<h3 id="Chapter-15"><a href="#Chapter-15" class="headerlink" title="Chapter 15"></a>Chapter 15</h3><h4 id="Question-1-13"><a href="#Question-1-13" class="headerlink" title="Question 1"></a>Question 1</h4><p>create a SQLITE database or use an existing database and create a table in the database called “Ages”:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Ages (</span><br><span class="line">  name VARCHAR(128),</span><br><span class="line">  age INTEGER</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Then make sure the table is empty by deleting any rows that you previously inserted, and insert these rows and only these rows with the following commands:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM Ages;</span><br><span class="line">INSERT INTO Ages (name, age) VALUES (&#x27;Muqadaas&#x27;, 29);</span><br><span class="line">INSERT INTO Ages (name, age) VALUES (&#x27;Sabine&#x27;, 13);</span><br><span class="line">INSERT INTO Ages (name, age) VALUES (&#x27;Brydon&#x27;, 35);</span><br><span class="line">INSERT INTO Ages (name, age) VALUES (&#x27;Jayla&#x27;, 39);</span><br></pre></td></tr></table></figure>
<p>Once the inserts are done, run the following SQL command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT hex(name || age) AS X FROM Ages ORDER BY X</span><br></pre></td></tr></table></figure>
<h4 id="Question-2-4"><a href="#Question-2-4" class="headerlink" title="Question 2"></a>Question 2</h4><p><strong>Counting Organizations</strong><br>This application will read the mailbox data (mbox.txt) and count the number of email messages per organization (i.e. domain name of the email address) using a database with the following schema to maintain the counts.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Counts (org TEXT, count INTEGER)</span><br></pre></td></tr></table></figure>
<p>When you have run the program on <strong>mbox.txt</strong> upload the resulting database file above for grading.<br>If you run the program multiple times in testing or with dfferent files, make sure to empty out the data before each run.<br>You can use this code as a starting point for your application: <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/emaildb.py">http://www.py4e.com/code3/emaildb.py</a>.<br>The data file for this application is the same as in previous assignments: <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/mbox.txt">http://www.py4e.com/code3/mbox.txt</a>.<br><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import sqlite3</span><br><span class="line">conn = sqlite3.connect(&#x27;emaildb2.sqlite&#x27;)</span><br><span class="line">cur = conn.cursor()</span><br><span class="line">cur.execute(&#x27;&#x27;&#x27;</span><br><span class="line">DROP TABLE IF EXISTS Counts&#x27;&#x27;&#x27;)</span><br><span class="line">cur.execute(&#x27;&#x27;&#x27;</span><br><span class="line">CREATE TABLE Counts (org TEXT, count INTEGER)&#x27;&#x27;&#x27;)</span><br><span class="line">fh = open(&#x27;C:/Users/dell/Desktop/mbox.txt&#x27;, &#x27;r&#x27;)</span><br><span class="line">list_1 = []</span><br><span class="line">for line in fh:</span><br><span class="line">    if not line.startswith(&#x27;From: &#x27;):</span><br><span class="line">        continue</span><br><span class="line">    pieces = line.split()</span><br><span class="line">    email = pieces[1]</span><br><span class="line">    dom = email.find(&#x27;@&#x27;)</span><br><span class="line">    org = email[dom+1:len(email)]</span><br><span class="line">    cur.execute(&#x27;SELECT count FROM Counts WHERE org = ? &#x27;, (org,))</span><br><span class="line">    row = cur.fetchone()</span><br><span class="line">    if row is None:</span><br><span class="line">        cur.execute(&#x27;&#x27;&#x27;INSERT INTO Counts (org, count)</span><br><span class="line">                VALUES (?, 1)&#x27;&#x27;&#x27;, (org,))</span><br><span class="line">    else:</span><br><span class="line">        cur.execute(&#x27;UPDATE Counts SET count = count + 1 WHERE org = ?&#x27;,</span><br><span class="line">                    (org,))</span><br><span class="line">conn.commit()</span><br><span class="line"># https://www.sqlite.org/lang_select.html</span><br><span class="line">sqlstr = &#x27;SELECT org, count FROM Counts ORDER BY count DESC LIMIT 10&#x27;</span><br><span class="line">for row in cur.execute(sqlstr):</span><br><span class="line">    print(str(row[0]), row[1])</span><br><span class="line">cur.close()</span><br></pre></td></tr></table></figure>
<h4 id="Question-3-2"><a href="#Question-3-2" class="headerlink" title="Question 3"></a>Question 3</h4><p><strong>Musical Track Database</strong><br>This application will read an iTunes export file in XML and produce a properly normalized database with this structure:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE Artist (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">    name    TEXT UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE Genre (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">    name    TEXT UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE Album (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">    artist_id  INTEGER,</span><br><span class="line">    title   TEXT UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE Track (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY</span><br><span class="line">        AUTOINCREMENT UNIQUE,</span><br><span class="line">    title TEXT  UNIQUE,</span><br><span class="line">    album_id  INTEGER,</span><br><span class="line">    genre_id  INTEGER,</span><br><span class="line">    len INTEGER, rating INTEGER, count INTEGER</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>If you run the program multiple times in testing or with different files, make sure to empty out the data before each run.<br>You can use this code as a starting point for your application: <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/tracks.zip">http://www.py4e.com/code3/tracks.zip</a>. The ZIP file contains the <strong>Library.xml</strong> file to be used for this assignment. You can export your own tracks from iTunes and create a database, but for the database that you turn in for this assignment, only use the <strong>Library.xml</strong> data that is provided.<br>To grade this assignment, the program will run a query like this on your uploaded database and look for the data it expects to see:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT Track.title, Artist.name, Album.title, Genre.name</span><br><span class="line">    FROM Track JOIN Genre JOIN Album JOIN Artist</span><br><span class="line">    ON Track.genre_id = Genre.ID and Track.album_id = Album.id</span><br><span class="line">        AND Album.artist_id = Artist.id</span><br><span class="line">    ORDER BY Artist.name LIMIT 3</span><br></pre></td></tr></table></figure>
<p>The expected result of the modified query on your database is: (shown here as a simple HTML table with titles)<br><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">import xml.etree.ElementTree as ET</span><br><span class="line">import sqlite3</span><br><span class="line">conn = sqlite3.connect(&#x27;trackdb.sqlite&#x27;)</span><br><span class="line">cur = conn.cursor()</span><br><span class="line"># Make some fresh tables using executescript()</span><br><span class="line">cur.executescript(&#x27;&#x27;&#x27;</span><br><span class="line">DROP TABLE IF EXISTS Artist;</span><br><span class="line">DROP TABLE IF EXISTS Album;</span><br><span class="line">DROP TABLE IF EXISTS Genre;</span><br><span class="line">DROP TABLE IF EXISTS Track;</span><br><span class="line">CREATE TABLE Artist (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">    name    TEXT UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE Album (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">    artist_id  INTEGER,</span><br><span class="line">    title   TEXT UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE Genre (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">    name   TEXT UNIQUE</span><br><span class="line">);</span><br><span class="line">CREATE TABLE Track (</span><br><span class="line">    id  INTEGER NOT NULL PRIMARY KEY</span><br><span class="line">        AUTOINCREMENT UNIQUE,</span><br><span class="line">    title TEXT  UNIQUE,</span><br><span class="line">    album_id  INTEGER,</span><br><span class="line">    genre_id  INTEGER,</span><br><span class="line">    len INTEGER, rating INTEGER, count INTEGER</span><br><span class="line">);</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line">fname = input(&#x27;Enter file name: &#x27;)</span><br><span class="line">if (len(fname) &lt; 1):</span><br><span class="line">    fname = &#x27;Library.xml&#x27;</span><br><span class="line"># &lt;key&gt;Track ID&lt;/key&gt;&lt;integer&gt;369&lt;/integer&gt;</span><br><span class="line"># &lt;key&gt;Name&lt;/key&gt;&lt;string&gt;Another One Bites The Dust&lt;/string&gt;</span><br><span class="line"># &lt;key&gt;Artist&lt;/key&gt;&lt;string&gt;Queen&lt;/string&gt;</span><br><span class="line">def lookup(d, key):</span><br><span class="line">    found = False</span><br><span class="line">    for child in d:</span><br><span class="line">        if found:</span><br><span class="line">            return child.text</span><br><span class="line">        if child.tag == &#x27;key&#x27; and child.text == key:</span><br><span class="line">            found = True</span><br><span class="line">    return None</span><br><span class="line">stuff = ET.parse(fname)</span><br><span class="line">all = stuff.findall(&#x27;dict/dict/dict&#x27;)</span><br><span class="line">print(&#x27;Dict count:&#x27;, len(all))</span><br><span class="line">for entry in all:</span><br><span class="line">    if (lookup(entry, &#x27;Track ID&#x27;) is None):</span><br><span class="line">        continue</span><br><span class="line">    name = lookup(entry, &#x27;Name&#x27;)</span><br><span class="line">    artist = lookup(entry, &#x27;Artist&#x27;)</span><br><span class="line">    album = lookup(entry, &#x27;Album&#x27;)</span><br><span class="line">    genre = lookup(entry, &#x27;Genre&#x27;)</span><br><span class="line">    count = lookup(entry, &#x27;Play Count&#x27;)</span><br><span class="line">    rating = lookup(entry, &#x27;Rating&#x27;)</span><br><span class="line">    length = lookup(entry, &#x27;Total Time&#x27;)</span><br><span class="line">    if name is None or artist is None or album is None:</span><br><span class="line">        continue</span><br><span class="line">    print(name, artist, album, genre, count, rating, length)</span><br><span class="line">    cur.execute(&#x27;&#x27;&#x27;INSERT OR IGNORE INTO Artist (name)</span><br><span class="line">        VALUES ( ? )&#x27;&#x27;&#x27;, (artist, ))</span><br><span class="line">    cur.execute(&#x27;SELECT id FROM Artist WHERE name = ? &#x27;, (artist, ))</span><br><span class="line">    artist_id = cur.fetchone()[0]</span><br><span class="line">    cur.execute(&#x27;&#x27;&#x27;INSERT OR IGNORE INTO Album (title, artist_id)</span><br><span class="line">        VALUES ( ?, ? )&#x27;&#x27;&#x27;, (album, artist_id))</span><br><span class="line">    cur.execute(&#x27;SELECT id FROM Album WHERE title = ? &#x27;, (album, ))</span><br><span class="line">    album_id = cur.fetchone()[0]</span><br><span class="line">    cur.execute(&#x27;&#x27;&#x27;INSERT OR IGNORE INTO Genre (name)</span><br><span class="line">    VALUES ( ? )&#x27;&#x27;&#x27;, (genre, ))</span><br><span class="line">    cur.execute(&#x27;SELECT id FROM Genre WHERE name = ? &#x27;, (genre, ))</span><br><span class="line">    genre_id = cur.fetchone()[0]</span><br><span class="line">    cur.execute(&#x27;&#x27;&#x27;INSERT OR REPLACE INTO Track</span><br><span class="line">        (title, album_id, genre_id, len, rating, count)</span><br><span class="line">        VALUES ( ?, ?, ?, ?, ?, ?)&#x27;&#x27;&#x27;,</span><br><span class="line">                (name, album_id, genre_id, length, rating, count))</span><br><span class="line">    conn.commit()</span><br></pre></td></tr></table></figure>
<h4 id="Question-4"><a href="#Question-4" class="headerlink" title="Question 4"></a>Question 4</h4><p>This application will read roster data in JSON format, parse the file, and then produce an SQLite database that contains a User, Course, and Member table and populate the tables from the data file.<br>You can base your solution on this code: <a target="_blank" rel="noopener" href="https://www.py4e.com/code3/roster/roster.py">http://www.py4e.com/code3/roster/roster.py</a> - this code is incomplete as you need to modify the program to store the <strong>role</strong> column in the <strong>Member</strong> table to complete the assignment.<br>Each student gets their own file for the assignment. Download <a target="_blank" rel="noopener" href="https://www.py4e.com/tools/sql-intro/roster_data.php?PHPSESSID=4e9bbaef3d818a7530c32084639a353c">this file</a> and save it as <code>roster_data.json</code>. Move the downloaded file into the same folder as your <code>roster.py</code> program.<br>Once you have made the necessary changes to the program and it has been run successfully reading the above JSON data, run the following SQL command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT hex(User.name || Course.title || Member.role ) AS X FROM</span><br><span class="line">    User JOIN Member JOIN Course</span><br><span class="line">    ON User.id = Member.user_id AND Member.course_id = Course.id</span><br><span class="line">    ORDER BY X</span><br></pre></td></tr></table></figure>
<p>Find the <strong>first</strong> row in the resulting record set and enter the long string that looks like <strong>53656C696E613333</strong>.<br><strong>Solution</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import sqlite3</span><br><span class="line"># PART 1: Creating the database</span><br><span class="line">dbname = &quot;roster.sqlite&quot;</span><br><span class="line">conn = sqlite3.connect(dbname)</span><br><span class="line">cur = conn.cursor()</span><br><span class="line">cur.executescript(&#x27;&#x27;&#x27;</span><br><span class="line">	DROP TABLE IF EXISTS User;</span><br><span class="line">	DROP TABLE IF EXISTS Course;</span><br><span class="line">	DROP TABLE IF EXISTS Member;</span><br><span class="line">	CREATE TABLE User (</span><br><span class="line">		id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">		name TEXT UNIQUE</span><br><span class="line">	);</span><br><span class="line">	CREATE TABLE Course (</span><br><span class="line">		id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</span><br><span class="line">		title TEXT UNIQUE</span><br><span class="line">	);</span><br><span class="line">	CREATE TABLE Member (</span><br><span class="line">		user_id INTEGER,</span><br><span class="line">		course_id INTEGER,</span><br><span class="line">		role INTEGER,</span><br><span class="line">		PRIMARY KEY(user_id, course_id)</span><br><span class="line">	)</span><br><span class="line">&#x27;&#x27;&#x27;)</span><br><span class="line"># Note: if we don&#x27;t add UNIQUE after &quot;User.name&quot; and &quot;Course.title&quot;,</span><br><span class="line"># the IGNORE statement won&#x27;t work and therefore we&#x27;ll have duplicates</span><br><span class="line"># PART 2: DESERIALIZING THE data</span><br><span class="line"># The JSON data we&#x27;re going to process is stored in an array form, with each</span><br><span class="line"># item being also an array of three elements: one corresponding to the username</span><br><span class="line"># one corresponding to the course name, and one indicating if the user is instructor</span><br><span class="line"># None of them has any field title.</span><br><span class="line">filename = &quot;roster_data.json&quot;</span><br><span class="line">jsondata = open(&#x27;C:/Users/dell/Desktop/roster_data.json&#x27;)</span><br><span class="line">data = json.load(jsondata)</span><br><span class="line"># PART 3: INSERTING DATA</span><br><span class="line">for entry in data:</span><br><span class="line">    user = entry[0]</span><br><span class="line">    course = entry[1]</span><br><span class="line">    instructor = entry[2]</span><br><span class="line">    # Inserting user</span><br><span class="line">    user_statement = &quot;&quot;&quot;INSERT OR IGNORE INTO User(name) VALUES( ? )&quot;&quot;&quot;</span><br><span class="line">    SQLparams = (user, )</span><br><span class="line">    cur.execute(user_statement, SQLparams)</span><br><span class="line">    # Inserting course</span><br><span class="line">    course_statement = &quot;&quot;&quot;INSERT OR IGNORE INTO Course(title) VALUES( ? )&quot;&quot;&quot;</span><br><span class="line">    SQLparams = (course, )</span><br><span class="line">    cur.execute(course_statement, SQLparams)</span><br><span class="line">    # Getting user and course id</span><br><span class="line">    courseID_statement = &quot;&quot;&quot;SELECT id FROM Course WHERE title = ?&quot;&quot;&quot;</span><br><span class="line">    SQLparams = (course, )</span><br><span class="line">    cur.execute(courseID_statement, SQLparams)</span><br><span class="line">    courseID = cur.fetchone()[0]</span><br><span class="line">    userID_statement = &quot;&quot;&quot;SELECT id FROM User WHERE name = ?&quot;&quot;&quot;</span><br><span class="line">    SQLparams = (user, )</span><br><span class="line">    cur.execute(userID_statement, SQLparams)</span><br><span class="line">    userID = cur.fetchone()[0]</span><br><span class="line">    # Inserting the entry</span><br><span class="line">    member_statement = &quot;&quot;&quot;INSERT INTO Member(user_id, course_id, role)</span><br><span class="line">		VALUES(?, ?, ?)&quot;&quot;&quot;</span><br><span class="line">    SQLparams = (userID, courseID, instructor)</span><br><span class="line">    cur.execute(member_statement, SQLparams)</span><br><span class="line"># Saving the changes</span><br><span class="line">conn.commit()</span><br><span class="line"># PART 4: Testing and obtaining the results</span><br><span class="line">test_statement = &quot;&quot;&quot;</span><br><span class="line">SELECT hex(User.name || Course.title || Member.role ) AS X FROM</span><br><span class="line">    User JOIN Member JOIN Course</span><br><span class="line">    ON User.id = Member.user_id AND Member.course_id = Course.id</span><br><span class="line">    ORDER BY X</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">cur.execute(test_statement)</span><br><span class="line">result = cur.fetchone()</span><br><span class="line">print(&quot;RESULT: &quot; + str(result))</span><br><span class="line"># Closing the connection</span><br><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

  
  
    
    <div class='footer'>
      
        <div class='references'>
          <section class='header'>
            
              <i class="fas fa-quote-left fa-fw" aria-hidden="true"></i>
            
            <span>参考资料（References）：</span>
          </section>
          <section class='body'>
            <ul>
              
                <li>
                  <a href="https://blog.csdn.net/u012348774/article/details/78106407" rel="external nofollow noopener noreferrer" target="_blank">
                  Python学习-PY4E作业
                  </a>
                </li>
              
            </ul>
          </section>
        </div>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>This work is licensed under a <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>

              
            
              
                <p>本文永久地址：<a href=http://blog.zhuangzhihao.top/Python-for-Everybody/>http://blog.zhuangzhihao.top/Python-for-Everybody/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          

        
      
        
          
<div class='new-meta-item author'>
  <a class='author' href="/about" rel="nofollow">
    <img no-lazy src="https://cn.bing.com/th?id=AMMS_fc8f99fd41ebd737a71c4e13806db9a0&w=110&h=110&c=7&rs=1&qlt=80&pcl=f9f9f9&cdv=1&dpr=2&pid=16.1">
    <p>Bezhuang</p>
  </a>
</div>

        
      
        
          

        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/Data-Science-Math-Skills/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>Data Science Math Skills</p>
          <p class='content'>
Data Science Math Skills course provided by DUKE UNIVERSITY is designed to teach the vocabulary,...</p>
        </a>
      
      
        <a class='next' href='/Sport-Related-Concussion-Training/'>
          <p class='title'>Sport-Related Concussion Training<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>
Some common sports injuries can occur when engaging in confrontational sports like basketball, t...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal shadow" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>






</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-1"><span class="toc-text">Chapter 1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-2"><span class="toc-text">Chapter 2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-1"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-3"><span class="toc-text">Chapter 3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-2"><span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-2"><span class="toc-text">Question 2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-4"><span class="toc-text">Chapter 4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-3"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-5"><span class="toc-text">Chapter 5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-4"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-6"><span class="toc-text">Chapter 6</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-5"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-7"><span class="toc-text">Chapter 7</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-6"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-8"><span class="toc-text">Chapter 8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-7"><span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-2-1"><span class="toc-text">Question 2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-9"><span class="toc-text">Chapter 9</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-8"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-10"><span class="toc-text">Chapter 10</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-9"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-11"><span class="toc-text">Chapter 11</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-10"><span class="toc-text">Question 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-12"><span class="toc-text">Chapter 12</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-11"><span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-2-2"><span class="toc-text">Question 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-3"><span class="toc-text">Question 3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-13"><span class="toc-text">Chapter 13</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-12"><span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-2-3"><span class="toc-text">Question 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-3-1"><span class="toc-text">Question 3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chapter-15"><span class="toc-text">Chapter 15</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-1-13"><span class="toc-text">Question 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-2-4"><span class="toc-text">Question 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-3-2"><span class="toc-text">Question 3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Question-4"><span class="toc-text">Question 4</span></a></li></ol></li></ol>
    </div>
  </section>


  


</aside>



		  
		  <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="Python for everybody";
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  // header 这里无论是否开启pjax都需要
  var l_header=document.getElementById("l_header");
  
  l_header.classList.add("show");
  
  
    // cover
    var cover_wrapper=document.querySelector('.cover-wrapper');
    
    cover_wrapper.id="none";
    cover_wrapper.style.display="none";
    
  
</script>

        </div>
        
  
  <footer class="footer clearfix">
    <br><br>
    
      
        
          <div><p>Copyright © 2021 Zhihao Zhuang. All rights reserved</p>
</div>
        
      
    
      
        
          <div><p><span id="lc-uv"> 本站访客数：<span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 人 | <span id="lc-sv"> 总访问量：<span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次</p>
</div>
        
      
    
  </footer>


        <a id="s-top" class="fas fa-arrow-up fa-fw" href="javascript:void(0)"></a>
      </div>
    </div>
    <div>
      <script>
/************这个文件存放不需要重载的全局变量和全局函数*********/
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/******************** Pjax ********************************/
function VPjax(){
	this.list=[] // 存放回调函数
	this.start=()=>{
	  for(var i=0;i<this.list.length;i++){
		this.list[i].run();
	  }
	}
	this.push=(fn,name)=>{
		var f=new PjaxItem(fn,name);
		this.list.push(f);
	}
	// 构造一个可以run的对象
	function PjaxItem(fn,name){
		// 函数名称
		this.name = name || fn.name
		// run方法
		this.run=()=>{
			fn()
		}
	}
}
volantis.pjax={}
volantis.pjax.method={
	complete: new VPjax(),
	error: new VPjax(),
	send: new VPjax()
}
volantis.pjax={
	...volantis.pjax,
	push: volantis.pjax.method.complete.push,
	error: volantis.pjax.method.error.push,
	send: volantis.pjax.method.send.push
}
/********************脚本懒加载函数********************************/
// 已经加入了setTimeout
function loadScript(src, cb) {
	setTimeout(function() {
		var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
		var script = document.createElement('script');
		script.setAttribute('type','text/javascript');
		if (cb) script.onload = cb;
		script.setAttribute('src', src);
		HEAD.appendChild(script);
	});
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
  };
  $(function () {
    SCload_fancybox();
  });
  function Pjax_SCload_fancybox(){
	if (typeof $.fancybox == "undefined") {
	 SCload_fancybox();
    } else {
	 pjax_fancybox();
    }
  }
  volantis.pjax.push(Pjax_SCload_fancybox)
  volantis.pjax.send(()=>{
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
  },'fancybox')
</script>


<!-- internal -->



  
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick="document.execCommand('copy')"><i class='fa fa-copy fa-fw'></i>复制文本</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>复制链接</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>在新标签页打开</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>复制图片地址</a>
        <hr id='hr-src'>
      </li>
      
        <li class='navigation'>
          <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
        </li>
      
      <hr>
      
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=https://www.zhuangzhihao.top
        
        
        
        
          id="https:wwwzhuangzhihaotop"
        >
        <i class='fa fa-fan fa-spin fa-fw'></i> 返回主页
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=https://github.com/Bezhuang/Hexo-blog
        
        
        
        
          id="https:githubcomBezhuangHexo-blog"
        >
        <i class='fa fa-code-branch fa-fw'></i> 本站源码
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' 
        
        
        
          onclick="document.execCommand('print')"
        
        >
        <i class='fa fa-print fa-fw'></i> 打印页面
      </a>
    </li>
  
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          if ('true' == 'true') {
            copyText.style.display = 'block';
            hrText.style.display = 'block';
          }
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }
      // 有音乐播放器 see: layout/_third-party/aplayer/script.ejs
      
      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>




<script>
  function loadIssuesJS() {
    if ($(".md").find(".issues-api").length == 0) return;
	
	  loadScript('/js/issues.js');
	
  };
  $(function () {
    loadIssuesJS();
  });
  volantis.pjax.push(()=>{
	if (typeof IssuesAPI == "undefined") {
	  loadIssuesJS();
	}
  },"IssuesJS")
</script>







  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
	volantis.pjax.push(pjax_initCopyCode)
</script>








  
  
<script src="/js/valine.js"></script>


<script>
  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;
    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧~";
    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }
    var valine = new Valine();
    valine.init(Object.assign({"path":null,"placeholder":"快来评论吧~","appId":"SK7sx66NNd5Bw3O3jvF2MVXq-MdYXbMMI","appKey":"j5I5paEqIfWfOlCg13vU2vNq","meta":["nick","mail","link"],"requiredFields":["nick","mail"],"enableQQ":true,"recordIP":true,"avatar":"robohash","pageSize":10,"lang":"zh-cn","highlight":true,"mathJax":true}, {
      el: '#valine_container',
      path: path,
      placeholder: pagePlaceholder,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps,
    }))
  }
  $(function () {
    pjax_valine();
  });
  volantis.pjax.push(pjax_valine);
</script>




  <script defer src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-pjax></script>



  
<script src="/js/app.js"></script>



<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('/js/search/hexo.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
		document.addEventListener("pjax:success", listenSearch);
	
}
</script>











  <script defer>

  const LCCounter = {
    app_id: 'SK7sx66NNd5Bw3O3jvF2MVXq-MdYXbMMI',
    app_key: 'j5I5paEqIfWfOlCg13vU2vNq',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'http://blog.zhuangzhihao.top' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'http://blog.zhuangzhihao.top' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'http://blog.zhuangzhihao.top' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>




  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
    localStorage.setItem(k, v);
};

const removeLS = (k) => {
    localStorage.removeItem(k);
};

const getLS = (k) => {
    return localStorage.getItem(k);
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
var btn=$("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn");
function bindToggleButton() {
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
volantis.pjax.push(bindToggleButton);
volantis.pjax.send(()=>{
	btn.unbind('click');
},'toggle-mode-btn-unbind');
</script>







<script src="//code.tidio.co/tu8j8vmfuovtkhsj4lgr7sub986gd1ku.js" async></script>


<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->

 
	   
	    


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = ["/artitalk/"];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）

      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
		// 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
		volantis.pjax.method.complete.start();
      } catch (e) {
        console.log(e);
      }
    });

    document.addEventListener('pjax:error', function (e) {
	  // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.error.start();
      window.location.href = e.triggerElement.href;
    });
</script>
 
	  
    </div>
  </body>
</html>
